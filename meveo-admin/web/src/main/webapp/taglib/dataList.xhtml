<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:e="http://primefaces.org/extension"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<ui:composition>

	<c:if test="${empty pdf}">
		<c:set var="pdf" value="false" />
	</c:if>
	<c:if test="${empty editable}">
		<c:set var="editable" value="false" />
	</c:if>
	<c:if test="${empty scrollable}">
		<c:set var="scrollable" value="false" />
	</c:if>
	<c:if test="${editable}">
		<c:if test="${empty editMode}">
			<c:set var="editMode" value="cell" />
		</c:if>
	</c:if>
	<c:if test="${empty edit}">
		<c:set var="edit" value="true" />
	</c:if>

	<c:if test="${empty checkMany}">
		<c:set var="checkMany" value="true" />
	</c:if>

	<c:if test="${empty exportButton}">
		<c:set var="exportButton" value="true" />
	</c:if>
	
	<c:if test="${empty exportToCsv}">
		<c:set var="exportToCsv" value="false" />
	</c:if>
	
	<c:if test="${empty importCsv}">
		<c:set var="importCsv" value="false" />
	</c:if>

	<c:if test="${empty resultsId}">
		<c:set var="resultsId" value="results" />
	</c:if>

	<c:if test="${empty formId}">
		<c:set var="formId" value="#{resultsId}_form" />
	</c:if>

	<c:if test="${dataModel==null}">
		<c:set var="dataModel" value="#{backingBean.lazyDataModel}" />
	</c:if>
    
    <c:if test="${sortBy==null}">
        <c:set var="sortBy" value="#{null}" />
    </c:if>
    
    <c:if test="${sortOrder==null}">
        <c:set var="sortOrder" value="ASCENDING" />
    </c:if>
    <c:if test="${empty rowsPerPage}">
        <c:set var="rowsPerPage" value="5,10,15" />
    </c:if>

	<p:panel id="#{resultsId}_panel" width="100">

		<h:form id="#{formId}" prependId="false">

			<p:dataTable id="datatable_#{resultsId}" var="entity"  scrollable="#{scrollable}"
				value="#{dataModel}" paginator="true" rows="10" editable="#{editable}" editMode="#{editMode}"  widgetVar="cellEntity"
				selection="#{backingBean.selectedEntities}" sortBy="#{sortBy}" sortOrder="#{sortOrder}"
				paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
				rowsPerPageTemplate="#{rowsPerPage}" lazy="true"
				binding="#{backingBean.dataTable}" styleClass="custom-grid"
				rowKey="#{entity.id}" first="#{backingBean.dataTableFirstAttribute}">
				<p:ajax event="page" listener="#{backingBean.onPageChange}" />
				<p:ajax event="toggleSelect" update="@this" process="@this" />
				<p:ajax event="rowSelectCheckbox" />
				<p:ajax event="rowUnselectCheckbox" />
				<p:ajax event="rowSelect" />
				<p:ajax event="rowUnselect" />
				<p:column selectionMode="multiple" style="width:2%"
					rendered="#{checkMany}" exportable="false" />
				<ui:insert />
			</p:dataTable>

			<!-- <p:commandButton id="#{formId}deleteEntitieslink" rendered="#{checkMany}"
					value="#{messages['commons.deleteMultiple']}"
					action="#{backingBean.deleteMany()}" icon="ui-icon-trash"
					onclick="if(confirm('#{messages['commons.confirmDelete']}')){return true;}else{return false;}"
					ajax="false" /> -->

			<p:commandButton id="#{formId}buttonExport" icon="ui-icon-xls"
				value="#{messages['commons.exportExcel']}" ajax="false"
				rendered="#{exportButton}">
				<p:dataExporter type="xls" target="datatable_#{resultsId}"
					fileName="data" pageOnly="false" />
			</p:commandButton>
			<p:commandButton id="#{formId}buttonXlsxExport" icon="ui-icon-xls"
				value="#{messages['commons.exportExcel']}" ajax="false"
				rendered="#{exportXlsxButton}">
        		<pe:exporter type="xlsx" target="datatable_#{resultsId}" fileName="data" pageOnly="false" skipComponents="true"/>
			</p:commandButton>
			<p:panelGrid columns="2" >
			<p:commandButton style="margin-left:4px;" value="Export to CSV" action="#{backingBean.exportToFile()}" rendered="#{exportToCsv}" ajax="false"/>
			<p:commandButton value="Import CSV"  rendered="#{importCsv}" type="button" onclick="PF('csvDialog').show();" />
			<p:dialog header="Import CSV"  id="#{formId}_strategyDlg" widgetVar="csvDialog" rendered="#{importCsv}">
            <p:panelGrid columns="2" >
		    <p:outputLabel for="#{formId}_strategy" style="width:180px;margin-left:-70px;" value="#{messages['notification.strategyImportType']}" />
            <p:selectOneMenu id="#{formId}_strategy" value="#{backingBean.strategyImportType}" >
            <f:selectItem itemLabel="#{messages['commons.select']}" />
            <f:selectItem itemLabel="#{messages['enum.strategyImportTypeEnum.UPDATED']}"  itemValue="UPDATED" /> 
			<f:selectItem itemLabel="#{messages['enum.strategyImportTypeEnum.REJECTE_IMPORT']}"  itemValue="REJECTE_IMPORT" />
            <f:selectItem itemLabel="#{messages['enum.strategyImportTypeEnum.REJECT_EXISTING_RECORDS']}"  itemValue="REJECT_EXISTING_RECORDS" />			
			<p:ajax event="valueChange" update="@this"></p:ajax>
           </p:selectOneMenu>
			</p:panelGrid>
			<br/><br/>
			<p:fileUpload fileUploadListener="#{backingBean.handleFileUpload}" update="@all" ajax="false"
			rendered="#{importCsv}" multiple="true" mode="advanced" dragDropSupport="true" fileLimit="5"/>
           </p:dialog>
		   </p:panelGrid>
			<p:panel styleClass="buttons-set-data-table">
				<ui:insert name="add-on-buttons" />
			</p:panel>

			<p:blockUI block="datatable_#{resultsId}"
				trigger="datatable_#{resultsId}">
        		LOADING<br />
				<p:graphicImage name="ajax-loader1.gif" library="img" />
			</p:blockUI>

			<p:panelGrid id="blockUIContentDataTable_#{resultsId}" columns="2"
				style="display:none;">
				<h:graphicImage library="img" name="ajax-loader1.gif"
					style="margin-right: 12px; vertical-align: middle;" />
				<h:outputText value="#{messages['message.loading.data']}"
					style="white-space: nowrap;" />
			</p:panelGrid>

		</h:form>
	</p:panel>

</ui:composition>

</html>
