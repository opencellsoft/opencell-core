<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui" xmlns:s="http://jboss.org/seam/faces" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:cc="http://java.sun.com/jsf/composite"
    xmlns:hf="http://java.sun.com/jsf/composite/tags" xmlns:hftl="http://hftl.org">

<cc:interface>
    <cc:attribute name="fieldItem" required="true" />
    <cc:attribute name="edit" default="true" />
    <cc:attribute name="newEntity" default="false" />

</cc:interface>

<cc:implementation>

    <hftl:decorateFormField fieldId="#{cc.parent.attrs.fieldIdPrefix}_entity#{(cc.parent.attrs.popup and cc.attrs.edit and cc.attrs.fieldItem==null)?'_noValue':''}#{cc.attrs.edit?'':'_view'}" label="#{cc.parent.attrs.label}"
        componentWidth="#{cc.parent.attrs.componentWidth}" newLine="#{cc.parent.attrs.newLine}" displayOneLine="#{cc.parent.attrs.displayOneLine}"
        styleClass="#{cc.parent.attrs.styleClass}" style="#{cc.parent.attrs.style}" labelStyle="#{cc.parent.attrs.labelStyle}" labelStyleClass="#{cc.parent.attrs.labelStyleClass}"
        inputStyle="#{cc.parent.attrs.inputStyle}" inputStyleClass="#{cc.parent.attrs.inputStyleClass}" labelWidth="#{cc.parent.attrs.labelWidth}"
        inputWidth="#{cc.parent.attrs.inputWidth}">


        <!-- Show a popup to select entity from a list -->
        <c:if test="#{cc.parent.attrs.popup}">

            <p:inputText id="#{cc.parent.attrs.fieldIdPrefix}_entity" rendered="#{cc.attrs.edit and cc.attrs.fieldItem!=null}"
                value="#{cc.attrs.fieldItem[cc.parent.attrs.valueLabelField]}" required="#{cc.parent.attrs.required}" size="#{cc.parent.attrs.size}" disabled="true" />
            <h:inputHidden id="#{cc.parent.attrs.fieldIdPrefix}_entity_noValue" rendered="#{cc.attrs.edit and cc.attrs.fieldItem==null}" required="#{cc.parent.attrs.required}" />
            <p:inputText rendered="#{cc.attrs.edit and cc.attrs.fieldItem==null}" value="" size="#{cc.parent.attrs.size}" required="#{cc.parent.attrs.required}" disabled="true" />

            <p:commandButton immediate="true"
                rendered="#{(cc.attrs.edit and !cc.parent.attrs.showPopupOnlyOnNew) or (cc.attrs.edit and cc.parent.attrs.showPopupOnlyOnNew and cc.attrs.newEntity)}"
                id="selectLink" onclick="PF('dlg_#{cc.parent.attrs.popupId}').show()" icon="ui-icon-search" />
            <p:tooltip for="selectLink" value="#{messages['commons.search']}" />


            <h:outputText id="#{cc.parent.attrs.fieldIdPrefix}_entity_view" rendered="#{not cc.attrs.edit}" value="#{cc.attrs.fieldItem[cc.parent.attrs.valueLabelField]}"
                styleClass="field-value" />

        </c:if>

        <!-- Select entity from a picklist and store a entity itself-->
        <c:if test="#{!cc.parent.attrs.fkToEntity and !cc.parent.attrs.popup}">

            <c:if test="#{cc.parent.attrs.listElements==null}">
                <c:set var="elements" value="#{cc.parent.attrs.listBean.listAll()}" />
            </c:if>
            <c:if test="#{cc.parent.attrs.listElements!=null}">
                <c:set var="elements" value="#{cc.parent.attrs.listElements}" />
            </c:if>

            <p:selectOneMenu rendered="#{cc.attrs.edit}" id="#{cc.parent.attrs.fieldIdPrefix}_entity" value="#{cc.attrs.fieldItem}" required="#{cc.parent.attrs.required}">
                <f:selectItem itemLabel="" itemValue="" />
                <f:selectItems value="#{elements}" var="elem" itemLabel="#{elem[cc.parent.attrs.valueLabelField]}" itemValue="#{elem}" />
                <s:objectConverter />
                <c:if test="#{not empty cc.parent.attrs.listenerUpdate}">
                    <p:ajax event="valueChange" update="#{cc.parent.attrs.listenerUpdate}" />
                </c:if>
            </p:selectOneMenu>

            <h:outputText id="#{cc.parent.attrs.fieldIdPrefix}_entity_view" rendered="#{not cc.attrs.edit}" value="#{cc.attrs.fieldItem[cc.parent.attrs.valueLabelField]}"
                styleClass="field-value" />
        </c:if>

        <!-- Select entity from a picklist but store only a code value-->
        <c:if test="#{cc.parent.attrs.fkToEntity and !cc.parent.attrs.popup}">
            <!-- if service is set, then load list of all entities from db and show as drop down list -->

            <c:if test="#{cc.parent.attrs.listElements==null}">
                <c:set var="elements" value="#{cc.parent.attrs.listBean.listAll()}" />
            </c:if>
            <c:if test="#{cc.parent.attrs.listElements!=null}">
                <c:set var="elements" value="#{cc.parent.attrs.listElements}" />
            </c:if>

            <p:selectOneMenu rendered="#{cc.attrs.edit}" id="#{cc.parent.attrs.fieldIdPrefix}_entity" value="#{cc.attrs.fieldItem}" required="#{cc.parent.attrs.required}">
                <f:selectItem itemLabel="" itemValue="                   " />
                <f:selectItems value="#{elements}" var="elem" itemLabel="#{elem[cc.parent.attrs.valueLabelField]}" itemValue="#{elem[cc.parent.attrs.valueField]}" />
                <s:objectConverter />
            </p:selectOneMenu>

            <h:outputText id="#{cc.parent.attrs.fieldIdPrefix}_entity_view" rendered="#{not cc.attrs.edit}"
                value="#{cc.parent.attrs.listBean.persistenceService.findByCode(cc.attrs.fieldItem)[cc.parent.attrs.valueLabelField]}" styleClass="field-value" />

        </c:if>

        <cc:insertChildren />
    </hftl:decorateFormField>

    <!--  <h:panelGroup layout="block" styleClass="formFieldGroup #{cc.parent.attrs.styleClass}" style="width:#{cc.parent.attrs.componentWidth}%; #{cc.parent.attrs.style}"> -->
    <!--         <p:outputLabel for="#{cc.parent.attrs.fieldIdPrefix}_entity#{cc.attrs.edit?'':'_view'}" value="#{cc.parent.attrs.label}" /> -->
    <!--         <h:panelGroup layout="block" styleClass="#{cc.parent.attrs.fieldStyle}  #{cc.parent.attrs.inputStyleClass}" -->
    <!--             style="width:#{cc.parent.attrs.inputWidth}%; #{cc.parent.attrs.inputStyle}"> -->

    <!--             Show a popup to select entity from a list -->
    <!--             <c:if test="#{cc.parent.attrs.popup}"> -->

    <!--                 <p:inputText id="#{cc.parent.attrs.fieldIdPrefix}_entity" rendered="#{cc.attrs.edit and cc.attrs.fieldItem!=null}" -->
    <!--                     value="#{cc.attrs.fieldItem[cc.parent.attrs.valueLabelField]}" required="#{cc.parent.attrs.required}" size="#{cc.parent.attrs.size}" disabled="true" /> -->


    <!--                 <h:inputHidden id="#{cc.parent.attrs.fieldIdPrefix}_entity_noValue" rendered="#{cc.attrs.edit and cc.attrs.fieldItem==null}" required="#{cc.parent.attrs.required}" /> -->
    <!--                 <p:inputText rendered="#{cc.attrs.edit and cc.attrs.fieldItem==null}" value="" size="#{cc.parent.attrs.size}" required="#{cc.parent.attrs.required}" disabled="true" /> -->

    <!--                 <p:commandButton immediate="true" -->
    <!--                     rendered="#{(cc.attrs.edit and !cc.parent.attrs.showPopupOnlyOnNew) or (cc.attrs.edit and cc.parent.attrs.showPopupOnlyOnNew and cc.attrs.newEntity)}" -->
    <!--                     id="selectLink" onclick="PF('dlg_#{cc.parent.attrs.popupId}').show()" icon="ui-icon-search" /> -->
    <!--                 <p:tooltip for="selectLink" value="#{messages['commons.search']}" /> -->


    <!--                 <h:outputText id="#{cc.parent.attrs.fieldIdPrefix}_entity_view" rendered="#{not cc.attrs.edit}" value="#{cc.attrs.fieldItem[cc.parent.attrs.valueLabelField]}" -->
    <!--                     styleClass="field-value" /> -->

    <!--             </c:if> -->

    <!--             Select entity from a picklist and store a entity itself -->
    <!--             <c:if test="#{!cc.parent.attrs.fkToEntity and !cc.parent.attrs.popup}"> -->

    <!--                 <c:if test="#{cc.parent.attrs.listElements==null}"> -->
    <!--                     <c:set var="elements" value="#{cc.parent.attrs.listBean.listAll()}" /> -->
    <!--                 </c:if> -->
    <!--                 <c:if test="#{cc.parent.attrs.listElements!=null}"> -->
    <!--                     <c:set var="elements" value="#{cc.parent.attrs.listElements}" /> -->
    <!--                 </c:if> -->

    <!--                 <p:selectOneMenu rendered="#{cc.attrs.edit}" id="#{cc.parent.attrs.fieldIdPrefix}_entity" value="#{cc.attrs.fieldItem}" required="#{cc.parent.attrs.required}"> -->
    <!--                     <f:selectItem itemLabel="" itemValue="" /> -->
    <!--                     <f:selectItems value="#{elements}" var="elem" itemLabel="#{elem[cc.parent.attrs.valueLabelField]}" itemValue="#{elem}" /> -->
    <!--                     <s:objectConverter /> -->
    <!--                     <c:if test="#{not empty cc.parent.attrs.listenerUpdate}"> -->
    <!--                         <p:ajax event="valueChange" update="#{cc.parent.attrs.listenerUpdate}" /> -->
    <!--                     </c:if> -->
    <!--                 </p:selectOneMenu> -->

    <!--                 <h:outputText id="#{cc.parent.attrs.fieldIdPrefix}_entity_view" rendered="#{not cc.attrs.edit}" value="#{cc.attrs.fieldItem[cc.parent.attrs.valueLabelField]}" -->
    <!--                     styleClass="field-value" /> -->
    <!--             </c:if> -->

    <!--             Select entity from a picklist but store only a code value -->
    <!--             <c:if test="#{cc.parent.attrs.fkToEntity and !cc.parent.attrs.popup}"> -->
    <!--                 if service is set, then load list of all entities from db and show as drop down list -->

    <!--                 <c:if test="#{cc.parent.attrs.listElements==null}"> -->
    <!--                     <c:set var="elements" value="#{cc.parent.attrs.listBean.listAll()}" /> -->
    <!--                 </c:if> -->
    <!--                 <c:if test="#{cc.parent.attrs.listElements!=null}"> -->
    <!--                     <c:set var="elements" value="#{cc.parent.attrs.listElements}" /> -->
    <!--                 </c:if> -->

    <!--                 <p:selectOneMenu rendered="#{cc.attrs.edit}" id="#{cc.parent.attrs.fieldIdPrefix}_entity" value="#{cc.attrs.fieldItem}" required="#{cc.parent.attrs.required}"> -->
    <!--                     <f:selectItem itemLabel="" itemValue="                   " /> -->
    <!--                     <f:selectItems value="#{elements}" var="elem" itemLabel="#{elem[cc.parent.attrs.valueLabelField]}" itemValue="#{elem[cc.parent.attrs.valueField]}" /> -->
    <!--                     <s:objectConverter /> -->
    <!--                 </p:selectOneMenu> -->

    <!--                 <h:outputText id="#{cc.parent.attrs.fieldIdPrefix}_entity_view" rendered="#{not cc.attrs.edit}" -->
    <!--                     value="#{cc.parent.attrs.listBean.persistenceService.findByCode(cc.attrs.fieldItem)[cc.parent.attrs.valueLabelField]}" styleClass="field-value" /> -->

    <!--             </c:if> -->

    <!--             <cc:insertChildren /> -->
    <!--         </h:panelGroup> -->
    <!--     </h:panelGroup>     -->

</cc:implementation>

</html>