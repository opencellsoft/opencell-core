<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	xmlns:s="http://jboss.org/seam/faces"
	xmlns:p="http://primefaces.org/ui" template="/layout/template.xhtml">

	<f:metadata>
		<f:event type="preRenderView"
			listener="#{pricePlanMatrixListBean.preRenderView}" />
	</f:metadata>
	<ui:define name="navigation">
		<ui:include src="/layout/navigation.xhtml" />
	</ui:define>

	<ui:define name="body">
		<hftl:entityPopup id="offerPopup"
			header="#{messages['offer.search']}"
			backingBean="#{offerTemplateBean}"
			searchField1Label="#{messages['offerTemplate.code']}"
			searchField1="code"
			searchField2Label="#{messages['offerTemplate.description']}"
			searchField2="description"
			column1Label="#{messages['offerTemplate.code']}" column1="code"
			column2Label="#{messages['offerTemplate.description']}"
			column2="description"
			selection="#{pricePlanMatrixListBean.filters['offerTemplate']}"
			lazy="false" dataModel="#{offerTemplateBean.listActive}"
			updateField=":searchPanel:searchForm:offer">
		</hftl:entityPopup>
		<hftl:entityPopup id="searchSellerPopup"
			header="#{messages['seller.search']}" backingBean="#{sellerBean}"
			searchField1Label="#{messages['BusinessEntity.code']}"
			searchField1="code" column1Label="#{messages['BusinessEntity.code']}"
			column1="code"
			column2Label="#{messages['BusinessEntity.description']}"
			column2="description"
			selection="#{pricePlanMatrixListBean.filters['seller']}" lazy="false"
			dataModel="#{sellerBean.listAll}"
			updateField=":searchPanel:searchForm:seller">
		</hftl:entityPopup>
		<hftl:entityPopup id="searchTradingCountryPopup"
			header="#{messages['country.search']}"
			backingBean="#{tradingCountryBean}"
			searchField1Label="#{messages['BusinessEntity.description']}"
			searchField1="prDescription"
			column1Label="#{messages['BusinessEntity.code']}"
			column1="countryCode"
			column2Label="#{messages['BusinessEntity.description']}"
			column2="prDescription"
			selection="#{pricePlanMatrixListBean.filters['tradingCountry']}"
			lazy="false" dataModel="#{tradingCountryBean.listAll}"
			updateField=":searchPanel:searchForm:tradingCountry">
		</hftl:entityPopup>
		<hftl:entityPopup id="searchTradingCurrencyPopup"
			header="#{messages['currency.search']}"
			backingBean="#{tradingCurrencyBean}"
			searchField1Label="#{messages['BusinessEntity.description']}"
			searchField1="prDescription"
			column1Label="#{messages['BusinessEntity.code']}"
			column1="currencyCode"
			column2Label="#{messages['BusinessEntity.description']}"
			column2="prDescription"
			selection="#{pricePlanMatrixListBean.filters['tradingCurrency']}"
			lazy="false" dataModel="#{tradingCurrencyBean.listAll}"
			updateField=":searchPanel:searchForm:tradingCurrency">
		</hftl:entityPopup>

		<hf:searchPanel id="searchPanel" columns="3"
			label="#{messages['pricePlanMatrix.search']}"
			backingBean="#{pricePlanMatrixListBean}"
			renderAdvancedLink="#{!pricePlanMatrixListBrean.advanced}"
			renderHideAdvancedLink="#{pricePlanMatrixListBean.advanced}">
			<hf:searchField label="#{messages['BusinessEntity.code']}"
				field="code" />
			<hf:searchField label="#{messages['pricePlanMatrix.eventCode']}"
				field="eventCode" />
			<hf:searchField id="offer"
				label="#{messages['pricePlanMatrix.offerCode']}"
				field="offerTemplate" valueLabelField="code" popup="true"
				popupId="offerPopup" clearButton="true" />
			<hf:searchField id="seller" label="#{messages['seller.title']}"
				field="seller" valueLabelField="description" popup="true"
				popupId="searchSellerPopup" clearButton="true" />
			<h:panelGroup rendered="#{pricePlanMatrixListBean.advanced}">
				<hf:searchField id="tradingCountry"
					label="#{messages['tradingCountry.tradingCountry']}"
					field="tradingCountry" valueLabelField="countryCode" popup="true"
					popupId="searchTradingCountryPopup" clearButton="true" />
				<hf:searchField id="tradingCurrency"
					label="#{messages['currency.codeCurrency']}"
					field="tradingCurrency" valueLabelField="currencyCode" popup="true"
					popupId="searchTradingCurrencyPopup" clearButton="true" />
				<hf:searchMinMaxField
					label="#{messages['pricePlanMatrix.quantity']}"
					minField="minQuantity" maxField="maxQuantity" />
				<hf:searchLikeCriteriasField
					label="#{messages['pricePlanMatrix.criteriaValue']}"
					fields="criteria1Value,criteria2Value,criteria3Value" />
				<hf:searchMinMaxField
					label="#{messages['pricePlanMatrix.subscriptionDate']}"
					minField="startSubscriptionDate" maxField="endSubscriptionDate" />
				<hf:searchMinMaxField
					label="#{messages['pricePlanMatrix.ratingDate']}"
					minField="startRatingDate" maxField="endRatingDate" />
				<hf:searchMinMaxField
					label="#{messages['pricePlanMatrix.subscriptionAgeInMonth']}"
					minField="minSubscriptionAgeInMonth"
					maxField="maxSubscriptionAgeInMonth" />
			</h:panelGroup>
		</hf:searchPanel>
		<script>
			//<![CDATA[
			PrimeFaces.widget.ColumnToggler.prototype.render = function() {
				var id = 0;
				this.columns = this.thead
						.find("> tr > th:visible:not(.ui-static-column)");
				this.panel = $("<div></div>")
						.attr("id", this.cfg.id)
						.addClass(
								"ui-columntoggler ui-widget ui-widget-content ui-shadow ui-corner-all")
						.append('<ul class="ui-columntoggler-items"></ul')
						.appendTo(document.body);
				this.itemContainer = this.panel.children("ul");
				for (var a = 0; a < this.columns.length; a++) {
					id++;
					var b = this.columns.eq(a);
					$(
							'<li class="ui-columntoggler-item"><div class="ui-chkbox ui-widget"><div id="cb' + id + '" class="ui-chkbox-box ui-widget ui-corner-all ui-state-default ui-state-active"><span class="ui-chkbox-icon ui-icon ui-icon-check"></span></div></div><label>'
									+ b.children(".ui-column-title").text()
									+ "</label></li>").data("column",
							b.attr("id")).appendTo(this.itemContainer);

					if (b.hasClass("dtcolumn-hidden")) {
						this.uncheck($('#cb' + id));
					}
				}

				this.hide();
			}
			//]]>
		</script>

		<hftl:dataList label="#{messages['pricePlanMatrix.title']}"
			editable="true" editMode="cell" scrollable="#{pricePlanMatrixListBean.lazyDataModel.size==0?'true':'false'}"
			exportButton="false" exportXlsxButton="true" checkMany="false"
			backingBean="#{pricePlanMatrixListBean}">
			<f:facet name="header">
				<p:commandButton id="toggler" type="button" style="float:right" disabled="#{backingBean.lazyDataModel.size==0?'true':'false'}"
					icon="ui-icon-calculator"/>
				<p:columnToggler datasource="datatable_results" trigger="toggler" />
			</f:facet>
			<p:column exportable="true" toggleable="false">
				<f:facet name="header">
					<h:outputText value="#{messages['BusinessEntity.code']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.code}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{entity.code}" required="true" maxlength="60"
							size="20" />
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" toggleable="false">
				<f:facet name="header">
					<h:outputText value="#{messages['pricePlanMatrix.eventCode']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.eventCode}" />
					</f:facet>
					<f:facet name="input">
						<h:selectOneMenu value="#{entity.eventCode}" style="width:75%"
							required="true">
							<f:selectItems value="#{chargeTemplateBean.listAll}" var="item"
								itemLabel="#{item.code}" itemValue="#{item.code}" />
							<s:objectConverter />
						</h:selectOneMenu>
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" toggleable="false">
				<f:facet name="header">
					<h:outputText value="#{messages['BusinessEntity.description']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.description}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{entity.description}" required="true"
							maxlength="100" size="20" />
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" >
				<f:facet name="header">
					<h:outputText value="#{messages['pricePlanMatrix.offerCode']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.offerTemplate.code}" />
					</f:facet>
					<f:facet name="input">
						<h:selectOneMenu value="#{entity.offerTemplate}" style="width:75%">
							<f:selectItem itemLabel="" itemValue="" />
							<f:selectItems value="#{offerTemplateBean.listAll}" var="item"
								itemLabel="#{item.code}" itemValue="#{item}" />
							<s:objectConverter />
						</h:selectOneMenu>
					</f:facet>
				</p:cellEditor>
			</p:column>

			<p:column exportable="true">
				<f:facet name="header">
					<h:outputText value="#{messages['seller.title']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.seller.code}" />
					</f:facet>
					<f:facet name="input">
						<h:selectOneMenu value="#{entity.seller}" style="width:75%">
							<f:selectItem itemLabel="" itemValue="" />
							<f:selectItems value="#{sellerBean.listAll}" var="item"
								itemLabel="#{item.code}" itemValue="#{item}" />
							<s:objectConverter />
						</h:selectOneMenu>
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" toggleable="#{pricePlanMatrixBean.entity.provider.entreprise}"
				rendered="#{!pricePlanMatrixBean.entity.provider.entreprise}">
				<f:facet name="header">
					<h:outputText value="#{messages['pricePlanMatrix.amountWithTax']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.amountWithTax}"
							converter="bigDecimal4DigitsConverter" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{entity.amountWithTax}" required="true"
							converter="bigDecimal4DigitsConverter" size="6" />
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" toggleable="#{!pricePlanMatrixBean.entity.provider.entreprise}">
				<f:facet name="header">
					<h:outputText
						value="#{messages['pricePlanMatrix.amountWithoutTax']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.amountWithoutTax}"
							converter="bigDecimal4DigitsConverter" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{entity.amountWithoutTax}" required="true"
							converter="bigDecimal4DigitsConverter" size="6" />
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" styleClass="dtcolumn-hidden">
				<f:facet name="header">
					<h:outputText value="#{messages['pricePlanMatrix.ratingDate']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.startRatingDate}">
							<f:convertDateTime
								pattern="#{paramBean.getProperty('meveo.dateFormat','dd/MM/yyyy')}" />
						</h:outputText>
						<h:outputText value=" - "
							rendered="#{not empty entity.startRatingDate or not empty entity.endRatingDate}" />
						<h:outputText value="#{entity.endRatingDate}">
							<f:convertDateTime
								pattern="#{paramBean.getProperty('meveo.dateFormat','dd/MM/yyyy')}" />
						</h:outputText>
					</f:facet>
					<f:facet name="input">
						<p:calendar value="#{entity.startRatingDate}"
							pattern="#{paramBean.getProperty('meveo.dateFormat','dd/MM/yyyy')}"
							size="10" showOn="button" />
						<h:outputText value=" - " />
						<p:calendar value="#{entity.endRatingDate}"
							pattern="#{paramBean.getProperty('meveo.dateFormat','dd/MM/yyyy')}"
							size="10" showOn="button" />
					</f:facet>
				</p:cellEditor>
			</p:column>

			<p:column exportable="true" styleClass="dtcolumn-hidden">
				<f:facet name="header">
					<h:outputText value="#{messages['pricePlanMatrix.criteriaEL']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.criteriaEL}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{entity.criteriaEL}" size="20"
							maxlength="255" />
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" styleClass="dtcolumn-hidden">
				<f:facet name="header">
					<h:outputText value="#{messages['tradingCountry.tradingCountry']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.tradingCountry.countryCode}" />
					</f:facet>
					<f:facet name="input">
						<h:selectOneMenu value="#{entity.tradingCountry}" style="width:75%">
							<f:selectItem itemLabel="" itemValue="" />
							<f:selectItems value="#{tradingCountryBean.listAll}" var="item"
								itemLabel="#{item.countryCode}" itemValue="#{item}" />
							<s:objectConverter />
						</h:selectOneMenu>
					</f:facet>
				</p:cellEditor>
			</p:column>

			<p:column exportable="true" styleClass="dtcolumn-hidden">
				<f:facet name="header">
					<h:outputText value="#{messages['currency.codeCurrency']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.tradingCurrency.currencyCode}" />
					</f:facet>
					<f:facet name="input">
						<h:selectOneMenu value="#{entity.tradingCurrency}" style="width:75%">
							<f:selectItem itemLabel="" itemValue="" />
							<f:selectItems value="#{tradingCurrencyBean.listAll}" var="item"
								itemLabel="#{item.currencyCode}" itemValue="#{item}" />
							<s:objectConverter />
						</h:selectOneMenu>
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" styleClass="dtcolumn-hidden">
				<f:facet name="header">
					<h:outputText value="#{messages['pricePlanMatrix.criteria1Value']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.criteria1Value}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{entity.criteria1Value}" size="20"
							maxlength="255" />
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" styleClass="dtcolumn-hidden">
				<f:facet name="header">
					<h:outputText value="#{messages['pricePlanMatrix.criteria2Value']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.criteria2Value}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{entity.criteria2Value}" size="20"
							maxlength="255" />
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" styleClass="dtcolumn-hidden">
				<f:facet name="header">
					<h:outputText value="#{messages['pricePlanMatrix.criteria3Value']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.criteria3Value}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{entity.criteria3Value}" size="20"
							maxlength="255" />
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" styleClass="dtcolumn-hidden">
				<f:facet name="header">
					<h:outputText value="#{messages['pricePlanMatrix.priority']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.priority}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{entity.priority}" size="6" />
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" styleClass="dtcolumn-hidden">
				<f:facet name="header">
					<h:outputText value="#{messages['pricePlanMatrix.quantity']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.minQuantity}" converter="bigDecimal4DigitsConverter"/>
						<h:outputText value=" - " />
						<h:outputText value="#{entity.maxQuantity}" converter="bigDecimal4DigitsConverter"/>
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{entity.minQuantity}" size="6" converter="bigDecimal4DigitsConverter"/>
						<h:outputText value=" - " />
						<p:inputText value="#{entity.maxQuantity}" size="6" converter="bigDecimal4DigitsConverter"/>
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" styleClass="dtcolumn-hidden">
				<f:facet name="header">
					<h:outputText
						value="#{messages['pricePlanMatrix.subscriptionDate']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.startSubscriptionDate}">
							<f:convertDateTime
								pattern="#{paramBean.getProperty('meveo.dateFormat','dd/MM/yyyy')}" />
						</h:outputText>
						<h:outputText value=" - " />
						<h:outputText value="#{entity.endSubscriptionDate}">
							<f:convertDateTime
								pattern="#{paramBean.getProperty('meveo.dateFormat','dd/MM/yyyy')}" />
						</h:outputText>
					</f:facet>
					<f:facet name="input">
						<p:calendar value="#{entity.startSubscriptionDate}"
							pattern="#{paramBean.getProperty('meveo.dateFormat','dd/MM/yyyy')}"
							size="10" showOn="button" />
						<h:outputText value=" - " />
						<p:calendar value="#{entity.endSubscriptionDate}"
							pattern="#{paramBean.getProperty('meveo.dateFormat','dd/MM/yyyy')}"
							size="10" showOn="button" />
					</f:facet>
				</p:cellEditor>
			</p:column>

			<p:column exportable="true" styleClass="dtcolumn-hidden">
				<f:facet name="header">
					<h:outputText
						value="#{messages['pricePlanMatrix.subscriptionAgeInMonth']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.minSubscriptionAgeInMonth} - " />
						<h:outputText value="#{entity.maxSubscriptionAgeInMonth}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{entity.minSubscriptionAgeInMonth}" size="6" />
						<h:outputText value=" - " />
						<p:inputText value="#{entity.maxSubscriptionAgeInMonth}" size="6" />
					</f:facet>
				</p:cellEditor>
			</p:column>
			<p:column exportable="true" styleClass="dtcolumn-hidden">
				<f:facet name="header">
					<h:outputText
						value="#{messages['pricePlanMatrix.validityCalendar']}" />
				</f:facet>
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{entity.validityCalendar.code}"/>
					</f:facet>
					<f:facet name="input">
						<h:selectOneMenu value="#{entity.validityCalendar}" style="width:75%">
							<f:selectItem itemLabel="" itemValue="" />
							<f:selectItems value="#{calendarBean.listAll}" var="item"
								itemLabel="#{item.code}" itemValue="#{item}" />
							<s:objectConverter />
						</h:selectOneMenu>
					</f:facet>
				</p:cellEditor>
			</p:column>

			<hftl:actionsColumn
				permission="#{identity.hasPermission('catalog','catalogManagement')}" />
		</hftl:dataList>
	</ui:define>
</ui:composition>
