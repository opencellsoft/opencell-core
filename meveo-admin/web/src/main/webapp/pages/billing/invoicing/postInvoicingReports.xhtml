<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	template="/layout/template.xhtml"
	xmlns:e="http://jboss.com/products/seam/excel"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="navigation">
		<ui:include src="/layout/navigation.xhtml" />
	</ui:define>

	<ui:define name="body">
        <p:messages id="messages" />
		<hf:formPanel formId="form3" edit="false"
			label="#{messages['postInvoicingReport.title']}"
			backingBean="#{billingRunBean}" showFormButtons="false">
					<hf:formField
						label="#{messages['postInvoicingReport.globalAmountHT']}"
						field="postInvoicingReports" childField="globalAmount"
						popup="false" />
					<hf:formField
						label="#{messages['postInvoicingReport.invoicesNumber']}"
						field="postInvoicingReports" childField="invoicesNumber"
						popup="false" />
					<hf:formField
						label="#{messages['postInvoicingReport.positiveInvoicesNumber']}"
						field="postInvoicingReports" childField="positiveInvoicesNumber"
						popup="false" />
					<hf:formField
						label="#{messages['postInvoicingReport.positiveInvoicesAmountHT']}"
						field="postInvoicingReports" childField="positiveInvoicesAmountHT"
						popup="false" />
					<hf:formField
						label="#{messages['postInvoicingReport.positiveInvoicesAmount']}"
						field="postInvoicingReports" childField="positiveInvoicesAmount"
						popup="false" />

					<hf:formField id="emptyInvoicesNumber"
						label="#{messages['postInvoicingReport.emptyInvoicesNumber']}"
						field="postInvoicingReports" childField="emptyInvoicesNumber"
						popup="false" />


					<hf:formField
						label="#{messages['postInvoicingReport.positiveInvoicesTaxAmount']}"
						field="postInvoicingReports"
						childField="positiveInvoicesTaxAmount" popup="false" />
					<hf:formField
						label="#{messages['postInvoicingReport.negativeInvoicesAmountHT']}"
						field="postInvoicingReports" childField="negativeInvoicesAmountHT"
						popup="false" />
					<hf:formField
						label="#{messages['postInvoicingReport.negativeInvoicesTaxAmount']}"
						field="postInvoicingReports"
						childField="negativeInvoicesTaxAmount" popup="false" />
					<hf:formField id="positiveInvoicesAmount"
						label="#{messages['postInvoicingReport.negativeInvoicesAmount']}"
						field="postInvoicingReports" childField="negativeInvoicesAmount"
						popup="false" />
					<hf:formField id="electronicInvoicesNumber"
						label="#{messages['postInvoicingReport.electronicInvoicesNumber']}"
						field="postInvoicingReports" childField="electronicInvoicesNumber"
						popup="false" />



			<b>#{messages['postInvoicingReport.invoicesNumberPerPaymentMode']}</b>

				<hf:formField label="#{messages['paymentMethod.check']}"
					field="postInvoicingReports" childField="checkInvoicesNumber"
					popup="false" />

				<hf:formField label="#{messages['paymentMethod.directDebit']}"
					field="postInvoicingReports" childField="directDebitInvoicesNumber"
					popup="false" />

				<hf:formField label="#{messages['paymentMethod.tip']}"
					field="postInvoicingReports" childField="tipInvoicesNumber"
					popup="false" />

				<hf:formField
					label="#{messages['paymentMethod.wiretransfer']}"
					field="postInvoicingReports"
					childField="wiretransferInvoicesNumber" popup="false" />


			<b>#{messages['postInvoicingReport.amoutHtPerPaymentMode']}</b>

				<hf:formField label="#{messages['paymentMethod.check']}"
					field="postInvoicingReports" childField="checkAmuontHT"
					popup="false" />

				<hf:formField label="#{messages['paymentMethod.directDebit']}"
					field="postInvoicingReports" childField="directDebitAmuontHT"
					popup="false" />

				<hf:formField label="#{messages['paymentMethod.tip']}"
					field="postInvoicingReports" childField="tipAmuontHT" popup="false" />

				<hf:formField
					label="#{messages['paymentMethod.wiretransfer']}"
					field="postInvoicingReports" childField="wiretransferAmuontHT"
					popup="false" />


			<b>#{messages['postInvoicingReport.amoutTtcPerPaymentMode']}</b>


				<hf:formField label="#{messages['paymentMethod.check']}"
					field="postInvoicingReports" childField="checkAmuont" popup="false" />

				<hf:formField label="#{messages['paymentMethod.directDebit']}"
					field="postInvoicingReports" childField="directDebitAmuont"
					popup="false" />

				<hf:formField label="#{messages['paymentMethod.tip']}"
					field="postInvoicingReports" childField="tipAmuont" popup="false" />

				<hf:formField
					label="#{messages['paymentMethod.wiretransfer']}"
					field="postInvoicingReports" childField="wiretransferAmuont"
					popup="false" />


		</hf:formPanel>


		<h:outputText value="#{messages['postInvoicingReport.billableBA']}"
			style="font-weight: bold;font-size=14;" />
		<hftl:dataList dataModel="#{billingRunBean.entity.invoices}"
			backingBean="#{invoiceBean}">

			<hftl:column label="#{messages['businessEntity.code']}"
				field="billingAccount.code" entityView="billingAccountDetail" valueIdField="billingAccount.id"/>
			<p:column width="100">
				<f:facet name="header">
					<h:outputText value="#{messages['name.title']}" />
				</f:facet>
				<e:cell>
					<h:outputText
						rendered="#{entity.billingAccount.name.title != null}"
						value="#{entity.billingAccount.name.title.description}" /> 
				</e:cell>
			</p:column>

			<hftl:column label="#{messages['billingAccount.name']}"
				field="billingAccount.name" />
			<hftl:column label="#{messages['invoice.amountWithoutTax']}"   
				field="amountWithoutTax" />
			<hftl:column label="#{messages['invoice.amountTax']}"
				field="amountTax" />
			<hftl:column label="#{messages['invoice.amountWithTax']}"
				field="amountWithTax" />
 
		</hftl:dataList>
	 
		 <p:panel styleClass="action-buttons" >
			<p:tooltip for="excludeBa"
				showEffect="slide" hideEffect="slide" />
			<p:commandButton id="excludeBa" style="left:10px; top:-26px" 
				value="#{messages['postInvoicingReport.excludeBillingAccounts']}"
				update=":results_form :messages" action="#{invoiceBean.excludeBillingAccounts(billingRunBean.entity)}" rendered="#{billingRunBean.entity.getInvoices().size()>0}">
				<p:confirm header="#{messages['message.confirmation']}"
					message="#{messages['commons.excludeBillingAccounts']}"
					icon="ui-icon-alert" />
			</p:commandButton>
		</p:panel>

		<p:confirmDialog global="true" showEffect="fade" hideEffect="explode">
			<p:commandButton value="#{messages['commons.yes']}" type="button"
				styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
			<p:commandButton value="#{messages['commons.no']}" type="button"
				styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
		</p:confirmDialog>


		<h:outputText
			value="#{messages['postInvoicingReport.rejectedBillingAccounts']}"
			style="font-weight: bold;font-size=14;" />
		<p:panel id="rejectedBA_panel" width="100">
			<h:form id="rejectedBA_formId" prependId="false">
				<p:dataTable id="dataTable_rejectedBA" var="entity"
					value="#{billingRunBean.entity.rejectedBillingAccounts}"
					paginator="true" rows="10" resizableColumns="true"
					binding="#{billingAccountBean.dataTable}"
					paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
					rowsPerPageTemplate="5,10,15" lazy="true" styleClass="custom-grid"
					rowKey="#{entity.id}">

					<hftl:column label="#{messages['businessEntity.code']}"
						field="billingAccount.code" />

					<p:column width="100">
						<f:facet name="header">
							<h:outputText value="#{messages['name.title']}" />
						</f:facet>
						<e:cell>
							<h:outputText
								rendered="#{entity.billingAccount.name.title != null}"
								value="#{entity.billingAccount.name.title.description}" />
						</e:cell>
					</p:column>

					<hftl:column label="#{messages['billingAccount.name']}"
						field="billingAccount.name" />

					<hftl:column
						label="#{messages['RejectedBillingAccounts.rejectCause']}"
						field="rejectCause" />

				</p:dataTable>

				<p:blockUI block="dataTable_rejectedBA"
					trigger="dataTable_rejectedBA">
        		LOADING<br />
					<p:graphicImage name="ajax-loader1.gif" library="img" />
				</p:blockUI>
			</h:form>
		</p:panel>

		<hftl:decorateFormField label="#{messages['billingRuns.launchInvoicing']}" displayOneLine="true" componentWidth="50">
			<p:selectBooleanCheckbox
				value="#{billingRunBean.launchInvoicingRejectedBA}" />
		</hftl:decorateFormField>

		<h:form id="operationsForm" rendered="#{!edit}">
			<div class="action-buttons">
				<p:commandButton action="#{billingRunBean.validateInvoicing()}"
					value="#{messages['action.validate']}" />
				<!-- <h:commandButton
				action="#{billingRunBean.rerateConfirmedInvoicing()}"
				value="Rerate" /> -->
				<p:commandButton
					action="#{billingRunBean.cancelConfirmedInvoicing()}"
					value="#{messages['action.cancel']}"
					onclick="if(confirm('#{messages['commons.confirmCancelInvoiceProcess']}')){return true;}else{return false;}" />
			</div>
		</h:form>
	</ui:define>
</ui:composition>
