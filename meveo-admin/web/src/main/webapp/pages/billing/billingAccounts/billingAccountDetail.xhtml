<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.org/seam/faces"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:o="http://omnifaces.org/ui" template="/layout/template.xhtml"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{billingAccountBean.preRenderView}" />

			<f:viewParam name="billingAccountId"
				value="#{billingAccountBean.objectId}" />
			<f:viewParam name="customerAccountId"
				value="#{billingAccountBean.customerAccountId}" />
			<f:viewParam name="customerAccountId"
				value="#{customerAccountBean.objectId}" />
			<f:viewParam name="customerId" value="#{customerBean.objectId}" />
		</f:metadata>

		<o:importConstants type="org.meveo.model.crm.CustomFieldTypeEnum" />
	</ui:define>

	<ui:define name="navigation">
		<ui:include src="/layout/navigation.xhtml" />
	</ui:define>

	<ui:define name="body">

		<c:if test="${billingAccountBean.edit}">

			<hftl:entityPopup id="customerAccountPopup"
				header="#{messages['customerAccount.popup.header']}"
				backingBean="#{customerAccountListBean}"
				searchField1Label="#{messages['customerAccount.code']}"
				searchField1="code"
				searchField2Label="#{messages['customerAccount.name']}"
				searchField2="name"
				column1Label="#{messages['customerAccount.code']}" column1="code"
				column2Label="#{messages['customerAccount.name']}" column2="name"
				selection="#{billingAccountBean.entity.customerAccount}"
				updateField=":parentTab:formBillingAccountPanel:formId:childTab:customerSelectId:customerSelectId">
			</hftl:entityPopup>

			<hftl:entityPopup id="billingCyclePopup"
				header="#{messages['billingCycle.popup.header']}"
				backingBean="#{billingCycleBean}"
				searchField1Label="#{messages['businessEntity.code']}"
				searchField1="code"
				searchField2Label="#{messages['businessEntity.description']}"
				searchField2="description"
				column1Label="#{messages['businessEntity.code']}" column1="code"
				column2Label="#{messages['businessEntity.description']}"
				column2="description"
				selection="#{billingAccountBean.entity.billingCycle}"
				updateField=":parentTab:formBillingAccountPanel:formId:childTab:cycleSelectId:cycleSelectId">
			</hftl:entityPopup>

			<hftl:entityPopup id="tradingCountryPopup"
				header="#{messages['tradingCountry.popup.header']}"
				backingBean="#{tradingCountryBean}"
				searchField1Label="#{messages['businessEntity.code']}"
				searchField1="countryCode"
				column1Label="#{messages['businessEntity.code']}"
				column1="countryCode"
				column2Label="#{messages['businessEntity.description']}"
				column2="prDescription"
				selection="#{billingAccountBean.entity.tradingCountry}"
				updateField=":parentTab:formBillingAccountPanel:formId:childTab:trCountrySelectId:trCountrySelectId">
			</hftl:entityPopup>

			<hftl:entityPopup id="tradingLanguagePopup"
				header="#{messages['tradingLanguage.popup.header']}"
				backingBean="#{tradingLanguageBean}"
				searchField1Label="#{messages['businessEntity.code']}"
				searchField1="languageCode"
				column1Label="#{messages['businessEntity.code']}"
				column1="languageCode"
				column2Label="#{messages['businessEntity.description']}"
				column2="prDescription"
				selection="#{billingAccountBean.entity.tradingLanguage}"
				updateField=":parentTab:formBillingAccountPanel:formId:childTab:trLanguageSelectId:trLanguageSelectId">
			</hftl:entityPopup>

		</c:if>

		<p:panelGrid styleClass="col2-set">
			<p:row>
				<p:column styleClass="col1">
					<hf:hierarchyPanel
						treeValue="#{customerTreeBean.buildAccountsHierarchy(billingAccountBean.entity)}"
						entity="#{billingAccountBean.entity}" />
				</p:column>
				<p:column styleClass="col2 tab-view-container">
					<p:tabView id="parentTab" styleClass="tab-parent">
						<p:tab title="#{messages['billingAccount.tab.account']}">
							<hf:formPanel id="formBillingAccountPanel"
								label="#{messages['billingAccount.billingAccountPanel']}"
								backingBean="#{billingAccountBean}" useCustomIdParam="true">
								<p:panel>
									<p:tabView id="childTab" styleClass="tab-child">
										<p:tab title="#{messages['billingAccount.tab.account']}">
											<hftl:fieldset
												name="#{messages['billingAccount.billingAccountPanel']}"
												columns="1">
												<hftl:panelGroup columns="1">
													<hf:formEntityField id="customerSelectId"
														label="#{messages['billingAccount.customerAccount']}"
														field="customerAccount" childField="code" required="true"
														popup="true" popupId="customerAccountPopup" />
												</hftl:panelGroup>
												<!--Creation window fields-->
												<hftl:panelGroup columns="2">
													<hf:formField label="#{messages['businessEntity.code']}"
														field="code" validateUnique="true" size="35"
														maxlength="35" required="true" />
													<hf:formEntityField
														label="#{messages['accountEntity.primaryContact']}"
														field="primaryContact" childField="code" popup="false"
														listBean="#{providerContactBean}" />
												</hftl:panelGroup>
												<hftl:panelGroup columns="1">
													<hf:formField
														label="#{messages['businessEntity.description']}"
														id="description" field="description" useConverter="false"
														size="70" maxlength="100" required="true" />
												</hftl:panelGroup>
												<hftl:panelGroup columns="2">
													<hf:formEntityField id="cycleSelectId"
														label="#{messages['billingAccount.billingCycle']}"
														field="billingCycle" childField="code" required="true"
														popup="true" popupId="billingCyclePopup" />
													<hf:emtyFormField />
													<hf:formEntityField
														label="#{messages['discountPlan.title']}"
														listBean="#{discountPlanBean}" field="discountPlan"
														childField="code" required="false" embedded="false" />
													<hf:emtyFormField />
													<h:panelGrid columns="2" id="invoicePrefixBoxPanel">
														<p:outputLabel for="returnToAgency_select"
															value="#{messages['billingAccount.returnToAgency']}" />
														<c:set var="fieldValueRA"
															value="#{billingAccountBean.returnToAgency}" />
														<h:selectBooleanCheckbox id="returnToAgency_select"
															rendered="#{billingAccountBean.edit}"
															value="#{fieldValueRA}">
															<p:ajax event="click" update="invoicePrefixPanel"
																action="#{billingAccountBean.setInvoicePrefix()}" />
														</h:selectBooleanCheckbox>

														<c:if test="${!billingAccountBean.edit}">
															<h:outputText
																rendered="#{fieldValueRA != null and fieldValueRA.toString() == 'true' and !billingAccountBean.edit}"
																value="#{messages['commons.yes']}"
																style="font-weight:bold;" />
															<h:outputText
																rendered="#{fieldValueRA != null and fieldValueRA.toString() == 'false' and !billingAccountBean.edit}"
																value="#{messages['commons.no']}"
																style="font-weight:bold;" />
															<h:outputText
																rendered="#{fieldValueRA != null and fieldValueRA.toString() != 'true' and fieldValueRA.toString() != 'false' and !billingAccountBean.edit}"
																value="#{messages[entity[field]]}"
																style="font-weight:bold;" />
														</c:if>
													</h:panelGrid>
													<h:panelGrid columns="2" id="invoicePrefixPanel"
														rendered="#{billingAccountBean.returnToAgency}">
														<p:outputLabel for="invoicePrefix"
															value="#{messages['billingAccount.invoicePrefix']}" />
														<h:outputText id="invoicePrefix"
															value="#{entity.invoicePrefix}" style="font-weight:bold;" />
													</h:panelGrid>

												</hftl:panelGroup>
												<hftl:panelGroup columns="2">
													<hf:formField
														label="#{messages['billingAccount.externalRef1']}"
														field="externalRef1" maxlength="50" useConverter="false" />
													<h:panelGrid columns="2">
														<p:outputLabel for="externalRef2"
															value="#{messages['billingAccount.externalRef2']}" />
														<p:inputText id="externalRef2"
															value="#{billingAccountBean.entity.externalRef2}"
															rendered="#{billingAccountBean.edit}"
															valueChangeListener="#{billingAccountBean.processValueChange}">
															<p:ajax event="valueChange" render="invoicePrefixPanel" />
														</p:inputText>
														<h:outputText
															value="#{billingAccountBean.entity.externalRef2}"
															rendered="#{!billingAccountBean.edit}"
															style="font-weight:bold;" />
													</h:panelGrid>

													<hf:formEntityField id="trCountrySelectId"
														label="#{messages['tradingCountry.tradingCountry']}"
														field="tradingCountry" childField="countryCode"
														required="true" popup="true" popupId="tradingCountryPopup" />
													<hf:formEntityField id="trLanguageSelectId"
														label="#{messages['tradingLanguage.tradingLanguage']}"
														field="tradingLanguage" childField="languageCode"
														required="true" popup="true"
														popupId="tradingLanguagePopup" />

												</hftl:panelGroup>
												<!--Edit window fields-->
												<hftl:panelGroup columns="1">
													<h:panelGrid columns="2">
														<p:outputLabel for="title_select"
															value="#{messages['name.title']}" />

														<p:selectOneMenu id="title_select"
															value="#{billingAccountBean.entity.name.title}"
															rendered="#{billingAccountBean.edit}">
															<f:selectItem itemLabel="" itemValue="" />
															<f:selectItems value="#{titleBean.listAll()}" var="t"
																itemLabel="#{t.description}" />
															<s:objectConverter />
															<p:ajax event="valueChange" immediate="false"
																update=":parentTab:formBillingAccountPanel:formId:childTab:invoicePrefixPanel :parentTab:formBillingAccountPanel:formId:childTab:invoicePrefixBoxPanel :parentTab:formBillingAccountPanel:formId:childTab:bankCoordinatePanel :parentTab:formBillingAccountPanel:formId:childTab:userNamePanel :parentTab:formBillingAccountPanel:formId:childTab:countryPanel" />
														</p:selectOneMenu>
														<h:outputText
															rendered="#{!billingAccountBean.edit and billingAccountBean.entity.name.title != null}"
															value="#{billingAccountBean.entity.name.title.description}"
															style="font-weight:bold;" />
													</h:panelGrid>

												</hftl:panelGroup>

												<h:panelGroup id="userNamePanel">
													<h:panelGrid columns="2" columnClasses="twoColGrid">
														<hf:formEntityField label="#{messages['name.lastName']}"
															field="name" childField="lastName" popup="false"
															maxlength="50" />

														<h:panelGrid columns="2"
															rendered="#{billingAccountBean.entity.name.title == null or !billingAccountBean.entity.name.title.isCompany}">
															<p:outputLabel for="firstName_select"
																value="#{messages['name.firstName']}" />
															<p:inputText id="firstName_select"
																value="#{billingAccountBean.entity.name.firstName}"
																rendered="#{(billingAccountBean.entity.name.title == null or !billingAccountBean.entity.name.title.isCompany) and billingAccountBean.edit}" />
															<h:outputText
																value="#{billingAccountBean.entity.name.firstName}"
																rendered="#{(billingAccountBean.entity.name.title == null or !billingAccountBean.entity.name.title.isCompany) and !billingAccountBean.edit}"
																style="font-weight:bold;" />
														</h:panelGrid>
														<hf:emtyFormField
															show="#{billingAccountBean.entity.name.title == null or !billingAccountBean.entity.name.title.isCompany}" />
													</h:panelGrid>
												</h:panelGroup>

												<hftl:panelGroup columns="2">
													<hf:formField label="#{messages['billingAccount.status']}"
														field="status" show="#{!billingAccountBean.edit}" />
													<hf:formField
														label="#{messages['billingAccount.statusDate']}"
														field="statusDate" show="#{!billingAccountBean.edit}" />
												</hftl:panelGroup>
												<hftl:panelGroup columns="2">
													<hf:formField
														label="#{messages['billingAccount.nextInvoiceDate']}"
														field="nextInvoiceDate" />
													<hf:formField
														label="#{messages['billingAccount.terminationDate']}"
														field="terminationDate" show="#{!billingAccountBean.edit}" />
													<hf:formField
														label="#{messages['billingAccount.subscriptionDate']}"
														field="subscriptionDate" />
												</hftl:panelGroup>

												<hftl:panelGroup columns="1">
													<hf:formField
														label="#{messages['accountEntity.defaultLevel']}"
														field="defaultLevel" isMessage="true" />
												</hftl:panelGroup>
											</hftl:fieldset>
										</p:tab>

										<p:tab id="tabInformation"
											title="#{messages['billingAccount.tab.information']}">
											<hftl:fieldset name="#{messages['commons.contacts']}"
												columns="1">
												<hftl:panelGroup columns="1">
													<hf:formEntityField label="#{messages['address.address1']}"
														field="address" childField="address1" popup="false"
														size="80" maxlength="80" />
													<hf:formEntityField label="#{messages['address.address2']}"
														field="address" childField="address2" popup="false"
														size="80" maxlength="80" />
													<hf:formEntityField label="#{messages['address.address3']}"
														field="address" childField="address3" popup="false"
														size="80" maxlength="80" />
												</hftl:panelGroup>
												<hftl:panelGroup columns="2">
													<hf:formEntityField label="#{messages['address.zipCode']}"
														field="address" childField="zipCode" popup="false"
														size="10" maxlength="10" length="10" />
													<hf:formEntityField label="#{messages['address.city']}"
														field="address" childField="city" popup="false"
														maxlength="50" />
													<hf:formEntityField id="countryPanel"
														label="#{messages['address.country']}" embedded="true"
														field="address" childField="country"
														labelField="descriptionEn" valueField="countryCode"
														listBean="#{countryBean}"></hf:formEntityField>
												</hftl:panelGroup>
											</hftl:fieldset>
											<p:panelGrid columns="1" id="bankCoordinatePanel">

												<hftl:fieldset name="#{messages['commons.bankCoordinates']}"
													columns="1">
													<hftl:panelGroup columns="2">
														<p:outputLabel for="paymentMethod"
															value="#{messages['billingAccount.paymentMethod']}" />
														<p:selectOneMenu id="paymentMethod"
															value="#{billingAccountBean.entity.paymentMethod}"
															rendered="#{billingAccountBean.edit}" required="true">
															<f:selectItem itemLabel="" itemValue="" />
															<f:selectItems
																value="#{cc.getEnumConstants('paymentMethod')}"
																var="enumElement"
																itemLabel="#{messages[enumElement.label]}" />
															<p:ajax event="valueChange" immediate="false"
																update=":parentTab:formBillingAccountPanel:formId:childTab" />
														</p:selectOneMenu>
														<h:outputText rendered="#{!billingAccountBean.edit}"
															value="#{billingAccountBean.entity.paymentMethod}"
															styleClass="field-value"></h:outputText>
													</hftl:panelGroup>

													<hf:formField id="paymentTerm"
														label="#{messages['billingAccount.paymentTerm']}"
														field="paymentTerm" required="false" />

													<hftl:panelGroup columns="2">
														<hf:formField
															label="#{messages['billingAccount.electronicBilling']}"
															field="electronicBilling" isMessage="true"
															listenerUpdate=":parentTab:formBillingAccountPanel:formId:childTab:emailField" />

														<p:panelGrid columns="2" id="emailField">
															<p:outputLabel for="email_select"
																value="#{messages['billingAccount.email']}" />

															<p:inputText id="email_select"
																rendered="#{billingAccountBean.edit}"
																value="#{billingAccountBean.entity.email}"
																required="#{billingAccountBean.entity.electronicBilling}"
																size="20" maxlength="100"
																converter="nullableStringConverter">
																<o:validator validatorId="javax.faces.RegularExpression"
																	pattern="([^.@]+)(\.[^.@]+)*@([^.@]+\.)+([^.@]+)"
																	message="#{messages['validator.email.invalid']}" />
															</p:inputText>
															<h:outputText rendered="#{!billingAccountBean.edit}"
																id="emailText"
																value="#{billingAccountBean.entity.email}"
																required="#{billingAccountBean.entity.electronicBilling}" />
														</p:panelGrid>
													</hftl:panelGroup>
													<h:panelGrid id="bankCoordinatesPanel" columns="1"
														rendered="#{billingAccountBean.entity.paymentMethod.toString() == 'DIRECTDEBIT' or billingAccountBean.entity.paymentMethod.toString() == 'TIP'}">
														<p:panelGrid columns="2" id="bankCoordinatesOutputPanel">
															<hf:formEntityField
																label="#{messages['bankCoordinates.bankCode']}"
																id="bankCode" field="bankCoordinates"
																childField="bankCode" size="5" maxlength="5"
																required="#{billingAccountBean.entity.paymentMethod.toString() == 'DIRECTDEBIT'}"
																validateRib="true" />
															<hf:formEntityField
																label="#{messages['bankCoordinates.branchCode']}"
																field="bankCoordinates" childField="branchCode" size="5"
																maxlength="5"
																required="#{billingAccountBean.entity.paymentMethod.toString() == 'DIRECTDEBIT'}" />
															<hf:formEntityField
																label="#{messages['bankCoordinates.accountNumber']}"
																field="bankCoordinates" childField="accountNumber"
																size="11" maxlength="11"
																required="#{billingAccountBean.entity.paymentMethod.toString() == 'DIRECTDEBIT'}" />
															<hf:formEntityField
																label="#{messages['bankCoordinates.key']}"
																field="bankCoordinates" childField="key" size="2"
																maxlength="2"
																required="#{billingAccountBean.entity.paymentMethod.toString() == 'DIRECTDEBIT'}" />
														</p:panelGrid>
														<hftl:panelGroup columns="1">
															<hf:formEntityField
																label="#{messages['bankCoordinates.bic']}"
																field="bankCoordinates" childField="bic" size="15"
																maxlength="11" />
															<hf:formEntityField
																label="#{messages['bankCoordinates.iban']}"
																field="bankCoordinates" childField="iban" size="45"
																maxlength="34" />
															<hf:formEntityField
																label="#{messages['bankCoordinates.accountOwner']}"
																field="bankCoordinates" childField="accountOwner"
																size="55" maxlength="50"
																required="#{entity.paymentMethod.toString() == 'DIRECTDEBIT'}" />
															<hf:formEntityField
																label="#{messages['bankCoordinates.bankName']}"
																field="bankCoordinates" childField="bankName" size="55"
																maxlength="50" />
														</hftl:panelGroup>

													</h:panelGrid>
												</hftl:fieldset>

											</p:panelGrid>
										</p:tab>

										<p:tab title="#{messages['customFieldTemplate.panel']}">
											<hf:customFields />
										</p:tab>

										<p:tab title="#{messages['counterPeriod.title']}"
											rendered="#{!billingAccountBean.edit or billingAccountBean.entity.id!=null}">
											<hftl:panelGroup>
												<p:panelGrid columns="2">
													<p:outputLabel for="counterPeriod"
														value="#{messages['counterInstance.title']}" />
													<p:selectOneMenu id="counterPeriod"
														converter="omnifaces.SelectItemsConverter"
														value="#{billingAccountBean.selectedCounterInstance}">
														<f:selectItems
															value="#{billingAccountBean.entity.counters}" />
														<p:ajax event="valueChange"
															update=":parentTab:formBillingAccountPanel:formId:childTab:counters" />
													</p:selectOneMenu>
												</p:panelGrid>
											</hftl:panelGroup>

											<p:panel id="counters">
												<hftl:panelGroup>
													<p:panelGrid columns="13">
														<p:outputLabel
															value="#{messages['businessEntity.description']} :" />
														<h:outputText
															value="#{billingAccountBean.selectedCounterInstance.description}" />
														<p:outputLabel
															value="#{messages['counterTemplate.title']} :" />
														<h:outputText
															value="#{billingAccountBean.selectedCounterInstance.counterTemplate.code}" />
													</p:panelGrid>
												</hftl:panelGroup>
												<hftl:dataList resultsId="datatable_counters"
													backingBean="#{counterPeriodBean}"
													dataModel="#{counterPeriodBean.getCounterPeriods(billingAccountBean.selectedCounterInstance)}"
													checkMany="false" sortBy="periodStartDate"
													sortOrder="DESCENDING">
													<hftl:column label="#{messages['businessEntity.code']}"
														field="code" />
													<hftl:column label="#{messages['businessEntity.description']}"
														field="description" />
													<hftl:column
														label="#{messages['counterTemplate.counterType']}"
														field="counterType" childField="label" isMessage="true" />
													<hftl:column
														label="#{messages['counterPeriod.periodStartDate']}"
														field="periodStartDate" isDate="true" />
													<hftl:column
														label="#{messages['counterPeriod.periodEndDate']}"
														field="periodEndDate" isDate="true" />
													<hftl:column label="#{messages['counterPeriod.level']}"
														field="level" converterParam="4digits" wrapHeader="true" />
													<hftl:column label="#{messages['counterPeriod.value']}"
														field="value" converterParam="4digits" wrapHeader="true" />
												</hftl:dataList>
											</p:panel>
										</p:tab>

									</p:tabView>
								</p:panel>
							</hf:formPanel>

							<h:form id="operationsForm"
								rendered="#{!billingAccountBean.edit}">
								<div class="action-buttons">
									<p:commandButton
										value="#{messages['account.buttonResiliateAccount']}"
										oncomplete="dlg_billingAccountTerminationPopup.show()"
										disabled="#{billingAccountBean.entity.status.toString() != 'ACTIVE'}" />
									<p:commandButton action="#{billingAccountBean.cancelAccount()}"
										value="#{messages['account.buttonCancelAccount']}"
										onclick="if(confirm('#{messages['account.confirmCancelAccount']}')){return true;}else{return false;}"
										disabled="#{billingAccountBean.entity.status.toString() != 'ACTIVE'}" />
									<p:commandButton id="terminateButton"
										action="#{billingAccountBean.closeAccount()}"
										value="#{messages['account.buttonCloseAccount']}"
										onclick="if(confirm('#{messages['customerAccount.confirmCloseAccount']}')){return true;}else{return false;}"
										disabled="#{billingAccountBean.entity.status.toString() != 'TERMINATED' and entity.status.toString() != 'CANCELLED'}" />
									<p:button outcome="addNewUserAccountAction"
										value="#{messages['billingAccount.addUserAccount']}"
										disabled="#{billingAccountBean.entity.status.toString() != 'ACTIVE'}">
										<f:param name="cid"
											value="#{javax.enterprise.context.conversation.id}" />
									</p:button>
								</div>
							</h:form>

						</p:tab>

						<p:tab title="#{messages['billingAccount.tab.invoices']}"
							rendered="#{!billingAccountBean.edit}">
							<hf:formPanel formId="form3" backingBean="#{billingAccountBean}"
								showFormButtons="false">
								<hftl:panelGroup columns="3">
									<hf:formField label="#{messages['businessEntity.code']}"
										field="code" />
									<hf:formField label="#{messages['billingAccount.status']}"
										field="status" />
									<hf:formField label="#{messages['serviceInstance.statusDate']}"
										field="statusDate" />
								</hftl:panelGroup>
								<hftl:panelGroup columns="3">
									<hf:formEntityField id="customerAccountSelectId"
										label="#{messages['billingAccount.customerAccount']}"
										field="customerAccount" childField="code" popup="false" />
									<hf:formField
										label="#{messages['billingAccount.subscriptionDate']}"
										field="subscriptionDate" />
									<hf:formField
										label="#{messages['billingAccount.terminationDate']}"
										field="terminationDate" />
								</hftl:panelGroup>
							</hf:formPanel>

							<hftl:dataList
								dataModel="#{invoiceBean.getBillingAccountInvoices(billingAccountBean.entity)}"
								resultsId="i_results" checkMany="false"
								backingBean="#{invoiceBean}">
								<hftl:column label="#{messages['invoice.invoiceNumber']}"
									field="invoiceNumber" />
								<hftl:column label="#{messages['invoice.invoiceDate']}"
									field="invoiceDate" />
								<hftl:column label="#{messages['invoice.dueDate']}"
									field="dueDate" />
								<hftl:column label="#{messages['invoice.amountWithTax']}"
									field="amountWithTax" />
								<hftl:column label="#{messages['invoice.paymentMethod']}"
									field="paymentMethod" childField="label" isMessage="true" />
								<p:column width="100">
									<f:facet name="header">
										<h:outputText value="#{messages['billingAccount.status']}" />
									</f:facet>
									<h:outputText
										value="#{messages[entity.billingRun.status.label]}" />
								</p:column>
								<p:column width="100">
									<f:facet name="header">
										<h:outputText value="#{messages['billingAccount.invoice']}" />
									</f:facet>
									<h:commandLink
										action="#{billingAccountBean.generatePDF(entity.id)}"
										rendered="#{billingAccountBean.pdfExists(entity.id)}">
										<h:graphicImage value="/img/pdf.gif" style="border:0" />
									</h:commandLink>
								</p:column>
								<hftl:actionsColumn
									editView="/pages/billing/invoices/invoiceDetail.xhtml"
									renderEditLink="false" renderDeleteLink="false" />
							</hftl:dataList>
						</p:tab>
					</p:tabView>

				</p:column>
			</p:row>
		</p:panelGrid>

		<p:dialog id="billingAccountTerminationPopup"
			header="#{messages['billingAccount.accountTermination']}"
			widgetVar="dlg_billingAccountTerminationPopup" dynamic="false"
			width="400">
			<hf:formPanel edit="true" backingBean="#{billingAccountBean}"
				styleClass="formPanel" formId="termFrm" showFormButtons="false"
				useCustomIdParam="true">
				<p:panelGrid columns="1">
					<hf:formField label="#{messages['serviceInstance.code']}"
						field="code" size="50" edit="false" />
					<hf:formField
						label="#{messages['serviceInstance.terminationDate']}"
						field="terminationDate" required="true" edit="true" />
					<hf:formEntityField label="Motifs " field="terminationReason"
						childField="description" required="true" popup="false" edit="true"
						listElements="#{subscriptionTerminationReasonService.listReasons()}" />
					<!-- update=":#{p:component('formBillingAccountPanel')}" -->
					<p:panel styleClass="action-buttons">
						<p:commandButton action="#{billingAccountBean.terminateAccount()}"
							value="#{messages['button.terminateButton']}" ajax="true"
							onsuccess="dlg_billingAccountTerminationPopup.hide()"
							update=":#{p:component('operationsForm')} :#{p:component('childTab')} :parentTab:formBillingAccountPanel:formId:messages">
						</p:commandButton>
						<p:commandButton immediate="true"
							onclick="dlg_billingAccountTerminationPopup.hide()"
							value="#{messages['management.close']}" />
					</p:panel>
				</p:panelGrid>
			</hf:formPanel>
		</p:dialog>

	</ui:define>
</ui:composition>
