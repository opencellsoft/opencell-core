<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:p="http://primefaces.org/ui" template="/layout/template.xhtml">

	<ui:define name="navigation">
		<ui:include src="/layout/navigation.xhtml" />
	</ui:define>
	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{measurementBean.preRenderView}" />
		</f:metadata>
	</ui:define>

	<ui:define name="body">

		<p:panel header="#{messages['page.title.measuredValue']}"
			styleClass="form-panel">

			<p:messages id="formMessages" showDetail="true" showSummary="false"
				redisplay="false"></p:messages>

			<p:panelGrid columns="1" style="width: 100%">
				<h:form id="measurementForm">
					<p:panelGrid columns="4">

						<p:panelGrid columns="2">
							<p:outputLabel for="measurableQuantityCode"
								value="#{messages['entity.measuredvalue.measurableQuantityCode']}"></p:outputLabel>
							<p:selectOneMenu id="measurableQuantityCode" required="true"
								value="#{measurementBean.measurableQuantityCode}"
								converter="omnifaces.SelectItemsConverter" style="width: 150px">
								<f:selectItem itemLabel="" itemValue="" />
								<f:selectItems
									value="#{measurementBean.getMeasurableQuantityCodes()}"
									var="obj" itemValue="#{obj}" itemLabel="#{obj}"></f:selectItems>
								<p:ajax event="valueChange" update=":measurementForm"></p:ajax>
							</p:selectOneMenu>
						</p:panelGrid>

						<p:panelGrid columns="2"
							rendered="#{measurementBean.measurableQuantity != null}">
							<p:outputLabel for="measurablePeriod"
								value="#{messages['entity.measuredvalue.measurementPeriod']}"></p:outputLabel>
							<p:selectOneMenu id="measurablePeriod" required="true"
								value="#{measurementBean.measuredPeriod}"
								converter="omnifaces.SelectItemsConverter" style="width: 150px">
								<f:selectItem itemLabel="" itemValue="" />
								<f:selectItems value="#{measurementBean.getMeasurePeriods()}"
									var="obj" itemValue="#{obj}"
									itemLabel="#{messages['enum.measurementperiod.'.concat(obj)]}"></f:selectItems>
								<p:ajax event="valueChange" update=":measurementForm"></p:ajax>
							</p:selectOneMenu>
						</p:panelGrid>

						<p:panelGrid columns="2"
							rendered="#{measurementBean.measurableQuantity != null}">
							<p:outputLabel for="selectedDate"
								value="#{messages['commons.date']}" />
							<p:calendar id="selectedDate"
								value="#{measurementBean.selectedDate}" required="true"
								pattern="MMMM yyyy">
								<p:ajax event="dateSelect" update=":measurementForm"></p:ajax>
							</p:calendar>
						</p:panelGrid>

						<p:commandButton value="Display Table"
							action="#{measurementBean.generateMVModel()}"
							update=":mqTableForm "
							rendered="#{(measurementBean.measurableQuantity != null)  and (measurementBean.selectedDate != null)}" />
					</p:panelGrid>

					<p:panelGrid columns="4">
						<p:panelGrid columns="2"
							rendered="#{measurementBean.measurableQuantityCode != null}">
							<p:outputLabel for="dimension1Filter"
								value="#{messages['entity.measurablequantity.dimension1']}"></p:outputLabel>
							<p:selectOneMenu id="dimension1Filter"
								value="#{measurementBean.dimension1Filter}"
								converter="omnifaces.SelectItemsConverter"
								rendered="#{measurementBean.measurableQuantity == null}">
								<f:selectItem itemLabel="" itemValue="" />
								<f:selectItems value="#{measurementBean.getDimensionList(1)}"
									var="obj" itemValue="#{obj}"></f:selectItems>
								<p:ajax event="valueChange" update=":measurementForm"></p:ajax>
							</p:selectOneMenu>
							<p:outputLabel value="#{measurementBean.dimension1Filter}"
								rendered="#{measurementBean.measurableQuantity != null}"></p:outputLabel>
						</p:panelGrid>

						<p:panelGrid columns="2"
							rendered="#{measurementBean.measurableQuantityCode != null}">
							<p:outputLabel for="dimension2Filter"
								value="#{messages['entity.measurablequantity.dimension2']}"></p:outputLabel>
							<p:selectOneMenu id="dimension2Filter"
								value="#{measurementBean.dimension2Filter}"
								converter="omnifaces.SelectItemsConverter"
								rendered="#{measurementBean.measurableQuantity == null}">
								<f:selectItem itemLabel="" itemValue="" />
								<f:selectItems value="#{measurementBean.getDimensionList(2)}"
									var="obj" itemValue="#{obj}"></f:selectItems>
								<p:ajax event="valueChange" update=":measurementForm"></p:ajax>
							</p:selectOneMenu>
							<p:outputLabel value="#{measurementBean.dimension2Filter}"
								rendered="#{measurementBean.measurableQuantity != null}"></p:outputLabel>
						</p:panelGrid>

						<p:panelGrid columns="2"
							rendered="#{measurementBean.measurableQuantityCode != null}">
							<p:outputLabel for="dimension3Filter"
								value="#{messages['entity.measurablequantity.dimension3']}"></p:outputLabel>
							<p:selectOneMenu id="dimension3Filter"
								value="#{measurementBean.dimension3Filter}"
								converter="omnifaces.SelectItemsConverter"
								rendered="#{measurementBean.measurableQuantity == null}">
								<f:selectItem itemLabel="" itemValue="" />
								<f:selectItems value="#{measurementBean.getDimensionList(3)}"
									var="obj" itemValue="#{obj}"></f:selectItems>
								<p:ajax event="valueChange" update=":measurementForm"></p:ajax>
							</p:selectOneMenu>
							<p:outputLabel value="#{measurementBean.dimension3Filter}"
								rendered="#{measurementBean.measurableQuantity != null}"></p:outputLabel>
						</p:panelGrid>

						<p:panelGrid columns="2"
							rendered="#{measurementBean.measurableQuantityCode != null}">
							<p:outputLabel for="dimension4Filter"
								value="#{messages['entity.measurablequantity.dimension4']}"></p:outputLabel>
							<p:selectOneMenu id="dimension4Filter"
								value="#{measurementBean.dimension4Filter}"
								converter="omnifaces.SelectItemsConverter"
								rendered="#{measurementBean.measurableQuantity == null}">
								<f:selectItem itemLabel="" itemValue="" />
								<f:selectItems value="#{measurementBean.getDimensionList(4)}"
									var="obj" itemValue="#{obj}"></f:selectItems>
								<p:ajax event="valueChange" update=":measurementForm"></p:ajax>
							</p:selectOneMenu>
							<p:outputLabel value="#{measurementBean.dimension4Filter}"
								rendered="#{measurementBean.measurableQuantity != null}"></p:outputLabel>
						</p:panelGrid>
					</p:panelGrid>
				</h:form>

				<h:form id="mqTableForm">
					<p:dataTable id="mqTable" value="#{measurementBean.mainMVModel}"
						var="meas" rendered="#{measurementBean.mainMVModel != null}"
						editable="true" editMode="cell">

						<p:ajax event="cellEdit" listener="#{measurementBean.onCellEdit}"
							update=":#{p:component('formMessages')} " />

						<p:columnGroup type="header">
							<p:row>
								<p:column headerText="#{messages['commons.date']}" />
								<p:column headerText="#{messages['commons.value']}" />
							</p:row>
						</p:columnGroup>

						<p:column styleClass="ui-editable-column" id="col0">
							<h:outputText value="#{meas.date}">
								<f:convertDateTime
									pattern="#{paramBean.getProperty('format.date','dd/MM/yyyy')}" />
							</h:outputText>
						</p:column>

						<p:column styleClass="ui-editable-column" id="col1">
							<h:outputText value="#{meas.value}"
								rendered="#{not measurementBean.measurableQuantity.editable}" />
							<p:cellEditor
								rendered="#{measurementBean.measurableQuantity.editable}">
								<f:facet name="output">
									<h:outputText value="#{meas.value}" />
								</f:facet>
								<f:facet name="input">
									<p:inputText value="#{meas.value}">
									</p:inputText>
								</f:facet>
							</p:cellEditor>
						</p:column>
					</p:dataTable>

					<p:panel styleClass="form-panel-actions">

						<p:button value="#{messages['action.edit']}"
							rendered="#{!measurementBean.edit and measurementBean.objectId != null}"
							includeViewParams="true">
							<f:param name="edit" value="true" />
							<f:param name="#{measurementBean.objectId}"
								value="#{measurementBean.objectId}" />
						</p:button>

						<h:commandLink rendered="#{measurementBean.mainMVModel != null}">
							<h:outputText
								value="#{messages['page.measuredValue.exporttable']}"></h:outputText>
							<p:dataExporter type="xls" target="mqTable"
								fileName="measuredValueTable"
								postProcessor="#{measurementBean.generateExcelReport}" />
						</h:commandLink>
					</p:panel>
				</h:form>
			</p:panelGrid>
		</p:panel>

		<p:dialog id="editMV" header="#{messages['menu.measuredValue']}"
			showEffect="fade" widgetVar="editMVWidget" modal="true"
			appendTo="@(body)">
			<h:form id="editMVdialog">
				<p:panelGrid columns="2">
					<p:outputLabel for="mvdate"
						value="#{messages['entity.measuredvalue.date']}"></p:outputLabel>
					<h:outputText id="mvdate"
						value="#{measurementBean.selectedMV.date}" styleClass="value">
						<f:convertDateTime
							pattern="#{paramBean.getProperty('format.date','dd/MM/yyyy')}" />
					</h:outputText>

					<p:outputLabel for="mvPeriod"
						value="#{messages['entity.measuredvalue.measurementPeriod']}"></p:outputLabel>
					<h:outputText id="mvPeriod"
						value="#{messages['enum.measurementperiod.'.concat(measurementBean.selectedMV.measurementPeriod)]}"
						styleClass="value">
					</h:outputText>

					<p:outputLabel for="mvvalue"
						value="#{messages['entity.measuredvalue.value']}"></p:outputLabel>
					<p:inputText id="mvvalue"
						value="#{measurementBean.selectedMV.value}" />

					<p:commandButton value="#{messages['action.save']}"
						action="#{measurementBean.saveMV}" ajax="false"></p:commandButton>
				</p:panelGrid>
			</h:form>
		</p:dialog>

	</ui:define>

</ui:composition>
