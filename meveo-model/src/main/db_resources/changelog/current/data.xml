<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.2.xsd">

	<property name="now" value="now()" dbms="postgresql" />

	<changeSet id="#655_20150522" author="EdwardLegaspi">
		<insert tableName="ar_credit_category">
			<column name="id" valueNumeric="1" />
			<column name="version" valueNumeric="0" />
			<column name="disabled" valueBoolean="false" />
			<column name="created" valueDate="${now}" />
			<column name="code" value="PART_C" />
			<column name="description" value="Part C" />
			<column name="provider_id" valueNumeric="1" />
		</insert>
		<insert tableName="ar_credit_category">
			<column name="id" valueNumeric="2" />
			<column name="version" valueNumeric="0" />
			<column name="disabled" valueBoolean="false" />
			<column name="created" valueDate="${now}" />
			<column name="code" value="PART_M" />
			<column name="description" value="Part M" />
			<column name="provider_id" valueNumeric="1" />
		</insert>
		<insert tableName="ar_credit_category">
			<column name="id" valueNumeric="3" />
			<column name="version" valueNumeric="0" />
			<column name="disabled" valueBoolean="false" />
			<column name="created" valueDate="${now}" />
			<column name="code" value="PRO" />
			<column name="description" value="PRO" />
			<column name="provider_id" valueNumeric="1" />
		</insert>
		<insert tableName="ar_credit_category">
			<column name="id" valueNumeric="4" />
			<column name="version" valueNumeric="0" />
			<column name="disabled" valueBoolean="false" />
			<column name="created" valueDate="${now}" />
			<column name="code" value="VIP" />
			<column name="description" value="VIP" />
			<column name="provider_id" valueNumeric="1" />
		</insert>
		<insert tableName="ar_credit_category">
			<column name="id" valueNumeric="5" />
			<column name="version" valueNumeric="0" />
			<column name="disabled" valueBoolean="false" />
			<column name="created" valueDate="${now}" />
			<column name="code" value="NEWCUSTOMER" />
			<column name="description" value="New Customer" />
			<column name="provider_id" valueNumeric="1" />
		</insert>
	</changeSet>

	<changeSet id="#655_20150523" author="EdwardLegaspi">
		<sql><![CDATA[ update ar_customer_account a set credit_category_id=(select b.id from ar_credit_category b where b.code=a.credit_category); ]]></sql>
		<sql><![CDATA[ update ar_dunning_plan a set credit_category_id=(select b.id from ar_credit_category b where b.code=a.credit_category); ]]></sql>
		<dropColumn tableName="ar_customer_account" columnName="credit_category" />
		<dropColumn tableName="ar_dunning_plan" columnName="credit_category" />
	</changeSet>

	<changeSet id="#852_20150605-1" author="EdwardLegaspi">
		<sql><![CDATA[ UPDATE CAT_COUNTER_TEMPLATE set COUNTER_TYPE='USAGE' WHERE COUNTER_TYPE IS NULL ]]></sql>
		<sql><![CDATA[ UPDATE CAT_COUNTER_TEMPLATE set COUNTER_LEVEL='UA' WHERE COUNTER_LEVEL IS NULL ]]></sql>
	</changeSet>
	
	<changeSet author="anasseh (generated)" id="878_2015-06-11">

		<insert tableName="meveo_script_instance">
			<column name="id" valueSequenceNext="meveo_script_instance_seq"  />
			<column name="version" valueNumeric="0" />
			<column name="disabled" valueBoolean="false" />
			<column name="created" valueDate="${now}" />
			<column name="code" value="Test_1" />
			<column name="description" value="first script" />
			<column name="script" value="here"/>
			<column name="provider_id" valueNumeric="1" />
			<column name="creator_id" valueNumeric="1" />
		</insert>
		
		<insert tableName="meveo_script_instance">
			<column name="id" valueSequenceNext="meveo_script_instance_seq"  />
			<column name="version" valueNumeric="0" />
			<column name="disabled" valueBoolean="false" />
			<column name="created" valueDate="${now}" />
			<column name="code" value="Test_2" />
			<column name="description" value="second script" />
			<column name="script" value="here"/>
			<column name="provider_id" valueNumeric="1" />
			<column name="creator_id" valueNumeric="1" />
		</insert>
		
		</changeSet>

	<changeSet id="#879_20150616" author="EdwardLegaspi">
		<insert tableName="CRM_CUSTOM_FIELD_TMPL">
			<column name="ID" valueSequenceNext="CRM_CUSTOM_FLD_TMP_SEQ" />
			<column name="PROVIDER_ID" valueNumeric="1" />
			<column name="CREATED" valueDate="${now}" />			
			<column name="DISABLED" valueBoolean="false" />
			<column name="CODE" value="CRM_ACCOUNT_TYPE" />
			<column name="DESCRIPTION" value="CRM Account Type" />
			<column name="ACCOUNT_TYPE" value="CUST" />
			<column name="VALUE_REQUIRED" valueBoolean="false" />
			<column name="FIELD_TYPE" value="STRING" />			
		</insert>
		<insert tableName="CRM_CUSTOM_FIELD_TMPL">
			<column name="ID" valueSequenceNext="CRM_CUSTOM_FLD_TMP_SEQ" />
			<column name="PROVIDER_ID" valueNumeric="1" />
			<column name="CREATED" valueDate="${now}" />			
			<column name="DISABLED" valueBoolean="false" />
			<column name="CODE" value="CRM_ACCOUNT_TYPE" />
			<column name="DESCRIPTION" value="CRM Account Type" />
			<column name="ACCOUNT_TYPE" value="CA" />
			<column name="VALUE_REQUIRED" valueBoolean="false" />
			<column name="FIELD_TYPE" value="STRING" />
		</insert>
		<insert tableName="CRM_CUSTOM_FIELD_TMPL">
			<column name="ID" valueSequenceNext="CRM_CUSTOM_FLD_TMP_SEQ" />
			<column name="PROVIDER_ID" valueNumeric="1" />
			<column name="CREATED" valueDate="${now}" />			
			<column name="DISABLED" valueBoolean="false" />
			<column name="CODE" value="CRM_ACCOUNT_TYPE" />
			<column name="DESCRIPTION" value="CRM Account Type" />
			<column name="ACCOUNT_TYPE" value="BA" />
			<column name="VALUE_REQUIRED" valueBoolean="false" />
			<column name="FIELD_TYPE" value="STRING" />
		</insert>
		<insert tableName="CRM_CUSTOM_FIELD_TMPL">
			<column name="ID" valueSequenceNext="CRM_CUSTOM_FLD_TMP_SEQ" />
			<column name="PROVIDER_ID" valueNumeric="1" />
			<column name="CREATED" valueDate="${now}" />			
			<column name="DISABLED" valueBoolean="false" />
			<column name="CODE" value="CRM_ACCOUNT_TYPE" />
			<column name="DESCRIPTION" value="CRM Account Type" />
			<column name="ACCOUNT_TYPE" value="UA" />
			<column name="VALUE_REQUIRED" valueBoolean="false" />
			<column name="FIELD_TYPE" value="STRING" />
		</insert>
		<insert tableName="CRM_CUSTOM_FIELD_TMPL">
			<column name="ID" valueSequenceNext="CRM_CUSTOM_FLD_TMP_SEQ" />
			<column name="PROVIDER_ID" valueNumeric="1" />
			<column name="CREATED" valueDate="${now}" />			
			<column name="DISABLED" valueBoolean="false" />
			<column name="CODE" value="CRM_ACCOUNT_PARENT" />
			<column name="DESCRIPTION" value="CRM Parent Account Code" />
			<column name="ACCOUNT_TYPE" value="CUST" />
			<column name="VALUE_REQUIRED" valueBoolean="false" />
			<column name="FIELD_TYPE" value="STRING" />
		</insert>
		<insert tableName="CRM_CUSTOM_FIELD_TMPL">
			<column name="ID" valueSequenceNext="CRM_CUSTOM_FLD_TMP_SEQ" />
			<column name="PROVIDER_ID" valueNumeric="1" />
			<column name="CREATED" valueDate="${now}" />			
			<column name="DISABLED" valueBoolean="false" />
			<column name="CODE" value="CRM_ACCOUNT_PARENT" />
			<column name="DESCRIPTION" value="CRM Parent Account Code" />
			<column name="ACCOUNT_TYPE" value="CA" />
			<column name="VALUE_REQUIRED" valueBoolean="false" />
			<column name="FIELD_TYPE" value="STRING" />
		</insert>
		<insert tableName="CRM_CUSTOM_FIELD_TMPL">
			<column name="ID" valueSequenceNext="CRM_CUSTOM_FLD_TMP_SEQ" />
			<column name="PROVIDER_ID" valueNumeric="1" />
			<column name="CREATED" valueDate="${now}" />			
			<column name="DISABLED" valueBoolean="false" />
			<column name="CODE" value="CRM_ACCOUNT_PARENT" />
			<column name="DESCRIPTION" value="CRM Parent Account Code" />
			<column name="ACCOUNT_TYPE" value="BA" />
			<column name="VALUE_REQUIRED" valueBoolean="false" />
			<column name="FIELD_TYPE" value="STRING" />
		</insert>
		<insert tableName="CRM_CUSTOM_FIELD_TMPL">
			<column name="ID" valueSequenceNext="CRM_CUSTOM_FLD_TMP_SEQ" />
			<column name="PROVIDER_ID" valueNumeric="1" />
			<column name="CREATED" valueDate="${now}" />			
			<column name="DISABLED" valueBoolean="false" />
			<column name="CODE" value="CRM_ACCOUNT_PARENT" />
			<column name="DESCRIPTION" value="CRM Parent Account Code" />
			<column name="ACCOUNT_TYPE" value="UA" />
			<column name="VALUE_REQUIRED" valueBoolean="false" />
			<column name="FIELD_TYPE" value="STRING" />
		</insert>
	</changeSet>
	
	<changeSet id="878_2015-06-11_2" author="anasseh">
	    <update tableName="meveo_script_instance">	        
	        <column name="code" value='TestScript' />
	        <column name="src_type" value='JAVA' />
	        <where>id=1</where>
        </update>
         <update tableName="meveo_script_instance">
	        <column name="code" value='TestScript_2' />
	        <column name="src_type" value='JAVA' />
	        <where>id=2</where>
        </update>
	</changeSet>
    
    <changeSet id="846-2015604-1" author="TyshanShi">
        <dropAllForeignKeyConstraints baseTableName="adm_user_provider"/>
        <dropTable tableName="adm_user_provider"/>
    </changeSet>
    <changeSet id="789-2015630-1" author="TyshanShi">
    	<sql><![CDATA[update crm_custom_field_tmpl set storage_type='SINGLE' where storage_type is null]]></sql>
    </changeSet>
        <changeSet id="#907_01072015_1" author="anasseh">
    	<sql><![CDATA[
    	INSERT INTO crm_custom_field_inst (id,version,disabled,created,updated,code,description,date_value,
    	double_value,long_value,string_value,provider_id,creator_id,updater_id,access_id,account_id,charge_template_id,
    	offer_template_id,service_template_id,subscription_id,versionable,calendar_id,job_instance_id,trigger_end_period_event,serialized_value) VALUES ( nextval('crm_custom_field_inst_seq'), 1, false, '2015-06-30 10:48:10.751', '2015-06-30 15:06:38.01', 'MediationJob_mappingConf', 'Mapping Conf', NULL, NULL, NULL, '<?xml version="1.0" encoding="ISO-8859-1"?>
<file-format>
    <converter name="char" class="com.blackbear.flatworm.converters.CoreConverters" method="convertChar" return-type="java.lang.String"/>
    <converter name="date" class="com.blackbear.flatworm.converters.CoreConverters" method="convertDate" return-type="java.util.Date"/>
    <converter name="bigDecimal" class="com.blackbear.flatworm.converters.CoreConverters" method="convertBigDecimal" return-type="java.math.BigDecimal"/>
    <record name="cdrRecord">
        <record-ident>
        </record-ident>
        <record-definition>
            <bean name="cdr" class="org.meveo.admin.parse.csv.CDR"/>
           <line delimit=";">
                <record-element length="0" beanref="cdr.timestamp" type="date">
                    <conversion-option name="format" value="yyyy-MM-dd''T''HH:mm:ss.SSS''Z''"/>                  
                </record-element>
                <record-element length="0" beanref="cdr.quantity" type="decimal">                 
                </record-element>
                <record-element length="0" beanref="cdr.access_id" type="char"/>
                <record-element length="0" beanref="cdr.param1" type="char" />
                <record-element length="0" beanref="cdr.param2" type="char" />
                <record-element length="0" beanref="cdr.param3" type="char" />
                <record-element length="0" beanref="cdr.param4" type="char" />
            </line>
        </record-definition>
    </record>
</file-format>', 1, 1, 1, NULL, NULL, NULL, NULL, NULL, NULL, false, NULL, 3,false, NULL);
    	]]></sql>
    </changeSet>

    <changeSet id="805_20150701-1" author="AndriusKarpavicius">

        <insert tableName="adm_permission">
            <column name="id" valueNumeric="13" />
            <column name="name" value="Remote import" />
            <column name="permission" value="remoteImport" />
            <column name="ressource" value="utilities" />
        </insert>
        <insert tableName="adm_role_permission">
            <column name="role_id" valueNumeric="2" />
            <column name="permission_id" valueNumeric="13" />
        </insert>
    </changeSet>
           <changeSet id="#907_01072015_2" author="anasseh">
    	<sql><![CDATA[
    	update crm_custom_field_inst VALUES  set string_value = '<?xml version="1.0" encoding="ISO-8859-1"?>
<file-format>
    <converter name="char" class="com.blackbear.flatworm.converters.CoreConverters" method="convertChar" return-type="java.lang.String"/>
    <converter name="date" class="com.blackbear.flatworm.converters.CoreConverters" method="convertDate" return-type="java.util.Date"/>
    <converter name="bigDecimal" class="com.blackbear.flatworm.converters.CoreConverters" method="convertBigDecimal" return-type="java.math.BigDecimal"/>
    <record name="cdrRecord">
        <record-ident>
        </record-ident>
        <record-definition>
            <bean name="cdr" class="org.meveo.admin.parse.csv.CDR"/>
           <line delimit=";">
                <record-element length="0" beanref="cdr.timestamp" type="date">
                    <conversion-option name="format" value="yyyy-MM-dd''T''HH:mm:ss.SSS''Z''"/>                  
                </record-element>
                <record-element length="0" beanref="cdr.quantity" type="bigDecimal">                 
                </record-element>
                <record-element length="0" beanref="cdr.access_id" type="char"/>
                <record-element length="0" beanref="cdr.param1" type="char" />
                <record-element length="0" beanref="cdr.param2" type="char" />
                <record-element length="0" beanref="cdr.param3" type="char" />
                <record-element length="0" beanref="cdr.param4" type="char" />
            </line>
        </record-definition>
    </record>
</file-format>' where string_value like '<?xml%' ;
    	]]></sql>
    </changeSet>
    
    <changeSet id="#911_20150723" author="EdwardLegaspi">
    	<insert tableName="adm_permission">
			<column name="id" valueNumeric="14" />
			<column name="name" value="API User" />
			<column name="permission" value="apiAccess" />
			<column name="ressource" value="user" />
		</insert>
		
		<insert tableName="adm_role_permission">
			<column name="role_id" valueNumeric="1" />
			<column name="permission_id" valueNumeric="14" />
		</insert>
    </changeSet>
    
    <changeSet id="#640_20150731-2" author="AndriusKarpavicius">
        <sql>update crm_custom_field_tmpl set code='PurgeJob_jobExecHistory_jobName', description='Purge job execution history: job name' where code='JobPurge_jobName'</sql>
        <sql>update crm_custom_field_tmpl set code='PurgeJob_jobExecHistory_nbDays', description='Purge job execution history: older then (in days)' where code='JobPurge_nbDays'</sql>
        <sql>update crm_custom_field_inst set code='PurgeJob_jobExecHistory_jobName', description='Purge job execution history: job name' where code='JobPurge_jobName'</sql>
        <sql>update crm_custom_field_inst set code='PurgeJob_jobExecHistory_nbDays', description='Purge job execution history: older then (in days)' where code='JobPurge_nbDays'</sql>
        <sql>update meveo_job_instance set job_template='PurgeJob' where job_template='JobPurge'</sql>
    </changeSet>
    
    <changeSet id="#969_20150819" author="EdwardLegaspi">
    	<sql>UPDATE CRM_CUSTOM_FIELD_TMPL SET version=0 WHERE code='CRM_ACCOUNT_TYPE' AND account_type='CUST';</sql>
		<sql>UPDATE CRM_CUSTOM_FIELD_TMPL SET version=0 WHERE code='CRM_ACCOUNT_TYPE' AND account_type='CA';</sql>
		<sql>UPDATE CRM_CUSTOM_FIELD_TMPL SET version=0 WHERE code='CRM_ACCOUNT_TYPE' AND account_type='BA';</sql>
		<sql>UPDATE CRM_CUSTOM_FIELD_TMPL SET version=0 WHERE code='CRM_ACCOUNT_TYPE' AND account_type='UA';</sql>
		<sql>UPDATE CRM_CUSTOM_FIELD_TMPL SET version=0 WHERE code='CRM_ACCOUNT_PARENT' AND account_type='CUST';</sql>
		<sql>UPDATE CRM_CUSTOM_FIELD_TMPL SET version=0 WHERE code='CRM_ACCOUNT_PARENT' AND account_type='CA';</sql>
		<sql>UPDATE CRM_CUSTOM_FIELD_TMPL SET version=0 WHERE code='CRM_ACCOUNT_PARENT' AND account_type='BA';</sql>
		<sql>UPDATE CRM_CUSTOM_FIELD_TMPL SET version=0 WHERE code='CRM_ACCOUNT_PARENT' AND account_type='UA';</sql>
    </changeSet>
    
    <changeSet id="1034-20150828-3" author="anasseh">  
	    <delete tableName="MEVEO_SCRIPT_INSTANCE">
        <where>script='here'</where>
    </delete>
    </changeSet>
    
    <changeSet id="805_20150701-2" author="AndriusKarpavicius">
        <insert tableName="adm_role_permission">
            <column name="role_id" valueNumeric="1" />
            <column name="permission_id" valueNumeric="13" />
        </insert>    
    </changeSet>
  
</databaseChangeLog>