<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.2.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <changeSet author="AndriusKarpavicius" id="rebuild-data-decisionRule">
        <insert tableName="wf_decision_rule">
            <column name="id" valueNumeric="1" />
            <column name="version" valueNumeric="0" />
            <column name="condition_el" value="#{mv:getCFValue(entity,'Territory')==_VALUE_}" />
            <column name="name" value="Territory" />
            <column name="type" value="STRING" />
            <column name="value" value="Other" />
            <column name="model" valueNumeric="1" />
        </insert>
        <insert tableName="wf_decision_rule">
            <column name="id" valueNumeric="2" />
            <column name="version" valueNumeric="0" />
            <column name="condition_el" value="#{mv:getCFValue(entity,'Territory')==_VALUE_}" />
            <column name="name" value="Territory" />
            <column name="type" value="STRING" />
            <column name="value" value="south" />
            <column name="model" valueNumeric="0" />
        </insert>
        <insert tableName="wf_decision_rule">
            <column name="id" valueNumeric="3" />
            <column name="version" valueNumeric="0" />
            <column name="condition_el" value="#{mv:getCFValue(entity,'Territory')==_VALUE_}" />
            <column name="name" value="Territory" />
            <column name="type" value="STRING" />
            <column name="value" value="west" />
            <column name="model" valueNumeric="1" />
        </insert>
        <insert tableName="wf_decision_rule">
            <column name="id" valueNumeric="4" />
            <column name="version" valueNumeric="0" />
            <column name="condition_el" value="#{mv:getCFValue(entity,'Territory')==_VALUE_}" />
            <column name="name" value="Territory" />
            <column name="type" value="STRING" />
            <column name="value" value="north" />
            <column name="model" valueNumeric="0" />
        </insert>
        <insert tableName="wf_decision_rule">
            <column name="id" valueNumeric="5" />
            <column name="version" valueNumeric="0" />
            <column name="condition_el" value="#{mv:getCFValue(entity,'SalesAmount')==_VALUE_}" />
            <column name="name" value="Sales amount" />
            <column name="type" value="STRING" />
            <column name="value" value="Other" />
            <column name="model" valueNumeric="1" />
        </insert>
        <insert tableName="wf_decision_rule">
            <column name="id" valueNumeric="6" />
            <column name="version" valueNumeric="0" />
            <column name="condition_el" value="#{mv:getCFValue(entity,'AccountType')==_VALUE_}" />
            <column name="name" value="Account Type" />
            <column name="type" value="STRING" />
            <column name="value" value="Other" />
            <column name="model" valueNumeric="1" />
        </insert>
    </changeSet>

    <changeSet author="AndriusKarpavicius" id="rebuild-data-paymentGateway">
        <insert tableName="ar_payment_gateway">
            <column name="id" valueNumeric="-1" />
            <column name="version" valueNumeric="0" />
            <column name="disabled" valueNumeric="0" />
            <column name="created" valueDate="${db.current.time}" />
            <column name="code" value="INGENICO_OGONE_SEPA" />
            <column name="description" value="Ingenico API Connect OGONE for Sepa payments" />
            <column name="type" value="NATIF" />
            <column name="payment_method" value="DIRECTDEBIT" />
            <column name="country_id" valueNumeric="70" />
            <column name="implementation_class_name" value="org.meveo.service.payments.impl.IngenicoGatewayPayment" />
            <column name="uuid" value="gateway_INGENICO_ONGONE" />
        </insert>
        <insert tableName="ar_payment_gateway">
            <column name="id" valueNumeric="-2" />
            <column name="version" valueNumeric="0" />

            <column name="created" valueDate="${db.current.time}" />
            <column name="code" value="SLIMPAY_SEPA" />
            <column name="description" value="Slimpay for Sepa payments" />
            <column name="type" value="NATIF" />
            <column name="payment_method" value="DIRECTDEBIT" />
            <column name="implementation_class_name" value="org.meveo.service.payments.impl.SlimpayGatewayPayment" />
            <column name="country_id" valueNumeric="220" />
            <column name="uuid" value="gateway_SLIMPAY" />
        </insert>
        <insert tableName="ar_payment_gateway">
            <column name="id" valueNumeric="-3" />
            <column name="version" valueNumeric="0" />

            <column name="created" valueDate="${db.current.time}" />
            <column name="code" value="INGENICO_OGONE_CARD" />
            <column name="description" value="Ingenico API Connect OGONE for Card payments" />
            <column name="type" value="NATIF" />
            <column name="payment_method" value="CARD" />
            <column name="implementation_class_name" value="org.meveo.service.payments.impl.SlimpayGatewayPayment" />
            <column name="trading_currency_id" value="-2" /><!-- EUR -->
            <column name="uuid" value="gateway_SLIMPAY" />
        </insert>
        <insert tableName="crm_provider_pay_methods">
            <column name="provider_id" valueNumeric="1" />
            <column name="payment_method" value="CARD" />
        </insert>
        <insert tableName="crm_provider_pay_methods">
            <column name="provider_id" valueNumeric="1" />
            <column name="payment_method" value="DIRECTDEBIT" />
        </insert>
        <insert tableName="crm_provider_pay_methods">
            <column name="provider_id" valueNumeric="1" />
            <column name="payment_method" value="PAYPAL" />
        </insert>
        <insert tableName="crm_provider_pay_methods">
            <column name="provider_id" valueNumeric="1" />
            <column name="payment_method" value="STRIPE" />
        </insert>
        <insert tableName="crm_provider_pay_methods">
            <column name="provider_id" valueNumeric="1" />
            <column name="payment_method" value="CHECK" />
        </insert>
    </changeSet>
    
    <changeSet author="AndriusKarpavicius" id="rebuild-data-payment-gateway">
        <sql><![CDATA[INSERT INTO ${db.schema.adapted}meveo_script_instance (id, version, disabled, created, code, description, src_type, script)
        VALUES (-10, 0, 0,  ${db.current.time}, 'org.meveo.service.script.demo.CustomGatewayPaymentScript', 'CustomGatewayPaymentScript', 'JAVA_CLASS', null);]]></sql>

        <sql><![CDATA[INSERT INTO ${db.schema.adapted}meveo_script_instance (id, version, disabled, created, code, description, src_type, script) VALUES (-11  , 0, 0,  ${db.current.time}, 'org.meveo.service.script.demo.PaymentCallBackScript', 'PaymentCallBackScript', 'JAVA_CLASS', null);]]></sql>

        <sql><![CDATA[INSERT INTO ${db.schema.adapted}ar_payment_gateway (id, version, disabled, created, updated, code, description, type, payment_method, card_type,
        implementation_class_name, script_instance_id, trading_currency_id, application_el, uuid, creator) VALUES (-10, 0, 0,  ${db.current.time}, NULL, 'customGatewayDemo', 'A customGateway for Demo', 'CUSTOM', 'CARD', NULL, NULL, -10, NULL, NULL,
          '3bb099a3-e72d-49ea-9d96-908e74569e02', 'opencell.admin');]]></sql>

        <sql><![CDATA[INSERT INTO ${db.schema.adapted}adm_notification (id, version, disabled, created, updated, code, description, class_name_filter, event_expression_filter, event_type_filter, creator, updater, counter_instance_id, counter_template_id, script_instance_id, priority) VALUES (-10, 0, 0,  ${db.current.time}, NULL, 'PaymentCallBack', NULL, 'org.meveo.model.notification.InboundRequest',
          '#{event.pathInfo.startsWith("/DEMO/custom_payment-callback?")}', 'INBOUND_REQ', 'opencell.admin', NULL, NULL, NULL, -11, 0);]]></sql>

        <sql><![CDATA[INSERT INTO ${db.schema.adapted}adm_notification_params VALUES (-10, '#{event.getParameters()}', 'params');]]></sql>
        <sql><![CDATA[ UPDATE ${db.schema.adapted}ar_payment_gateway set application_el ='#{"is already setup" eq "OK"}' where code <> 'customGatewayDemo';]]></sql>

    </changeSet>
    
    
    
    <changeSet author="ZBARIKI" id="#6048_20210326" dbms="postgresql"/>        
    <changeSet author="MohamedSTITANE" id="#6048_20210326" dbms="oracle"/>    

    <changeSet id="#INTRD-13383_20230123" author="bourras">
        <insert tableName="meveo_script_instance">
            <column name="id" valueSequenceNext="meveo_script_instance_seq"/>
            <column name="version" valueNumeric="0"/>
            <column name="code" value="org.meveo.service.script.product.OneShotOtherTypeMigrationScript"/>
            <column name="src_type" value="JAVA_CLASS"/>
            <column name="description" value="Migrate OneShot Charge of Type OTHER to INVOICING_PLAN"/>
            <column name="created" valueDate="${db.current.time}"/>
        </insert>
    </changeSet>
    
    <changeSet author="AmineBENAICHA" id="#6048_20210611">
        <insert tableName="meveo_script_instance">
            <column name="id" valueNumeric="-30"/>
            <column name="version" valueNumeric="0" />
            <column name="disabled" valueNumeric="0" />
            <column name="created" valueDate="${db.current.time}" />
            <column name="code" value="org.meveo.service.script.ServiceTemplateToProductScript" />
            <column name="description" value="Migration ServiceTemplate To Product" />
            <column name="src_type" value="JAVA_CLASS" />
        </insert>
        <insert tableName="meveo_job_instance">
            <column name="id" valueNumeric="-40" />
            <column name="version" valueNumeric="0" />
            <column name="disabled" valueNumeric="0" />
            <column name="created" valueDate="${db.current.time}" />
            <column name="updated" valueDate="null" />
            <column name="uuid" value="ServiceTemplateToProductJob" />
            <column name="code" value="ServiceTemplateToProductJob" />
            <column name="description" value="ServiceTemplateToProductJob" />
            <column name="job_category" value="MEDIATION" />
            <column name="job_template" value="ScriptingJob" />
            <column name="parametres" valueNumeric="null" />
            <column name="creator" value="opencell.admin" />
            <column name="updater" value="null" />
            <column name="timerentity_id" value="null" />
            <column name="cf_values">
                <![CDATA[
                    {"ScriptingJob_script":[{"entity":{"classname":"org.meveo.model.scripts.ScriptInstance","code":"org.meveo.service.script.ServiceTemplateToProductScript","id":-30}}],"ScriptingJob_TransactionType":[{"string":"REQUIRES_NEW"}]}
                ]]>
            </column>
        </insert>
    </changeSet>
    

       <!-- DONT REMOVE THIS CHANGESET - KEEP AT THE BOTTOM OF THE FILE  -->
    <changeSet id="#liquibase_hack_data-scripts" author="AbdelmounaimAkadid">
        <sql>update databasechangelog set filename='src/main/db_resources/changelog/current/data.xml' where filename='src/main/db_resources/changelog/rebuild/data-scripts.xml'</sql>
    </changeSet>

</databaseChangeLog>
